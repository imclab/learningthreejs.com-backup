<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title>Learning Three.js</title>
  <link href="http://learningthreejs.com/atom.xml" rel="self"/>
  <link href="http://learningthreejs.com/"/>
  <updated>2012-07-14T11:18:34+02:00</updated>
  <id>http://learningthreejs.com/</id>
  <author>
    <name>Jerome Etienne</name>
    
  </author>

  
  <entry>
    <title>Minecraft Character in WebGL</title>
    <link href="http://learningthreejs.com/blog/2012/07/05/minecraft-character-in-webgl/"/>
    <updated>2012-07-05T10:22:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2012/07/05/minecraft-character-in-webgl</id>
    <content type="html">&lt;p&gt;This post is about Minecraft Character.
We will play with the minecraft character, learn how to do your own and make it move.
I recently saw this excelent &lt;a href=&quot;http://djazz.mine.nu/lab/minecraft_items/&quot;&gt;minecraft items demo&lt;/a&gt;
by &lt;a href=&quot;https://twitter.com/#!/daniel_hede&quot;&gt;@daniel_hede&lt;/a&gt;. It triggered a switch in my head :)
I felt in love with minecraft style of 3d.
It makes modeling so simple.
You don't need to learn how to use 3d modeling software like
&lt;a href=&quot;http://www.blender.org/&quot;&gt;blender&lt;/a&gt;,
&lt;a href=&quot;http://usa.autodesk.com/maya/&quot;&gt;maya&lt;/a&gt; and such.
It is easy to create new model based on this style.&lt;/p&gt;

&lt;p&gt;Try the &lt;a href=&quot;http://learningthreejs.com/data/2012-07-05-minecraft-character-in-webgl/&quot;&gt;minecraft plugin demo&lt;/a&gt;. This is the
one we gonna build. I used &lt;a href=&quot;https://twitter.com/#!/daniel_hede&quot;&gt;@daniel_hede&lt;/a&gt;'s code
and did many plugins to make it all simple and fun :)
In this demo, i introduce
&lt;a href=&quot;https://github.com/mrdoob/three.js/tree/master/examples/js/postprocessing&quot;&gt;three.js post processing&lt;/a&gt;
for the first time.
This is the
&lt;a href=&quot;http://en.wikipedia.org/wiki/Vignetting&quot;&gt;Vignetting&lt;/a&gt;
and
&lt;a href=&quot;http://en.wikipedia.org/wiki/Sepia_(color)&quot;&gt;sepia color&lt;/a&gt;
that you see.
Additionnaly, you can easily change the skins with the UI within the demo.
Now let's get started!&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/eg0qshn4VC0&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;




&lt;!-- more --&gt;


&lt;h2&gt;Let's start coding&lt;/h2&gt;

&lt;p&gt;We start to create our world as usual. This initialize the renderer, the camera,
its controls and a rendering loop.
We setup the
&lt;a href=&quot;http://learningthreejs.com/blog/2012/01/19/boilerplate-builder-for-three-js/&quot;&gt;boilerplate for three.js&lt;/a&gt;
and add a page title with some info on our little 3D demo.
We just put the camera a little closer to scene center. Thus the character
will be bigger on screen. We just can't get enougth of it, can we ;)&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var world   = tQuery.createWorld().boilerplate().pageTitle('#info').start();
world.tCamera().position.z  = 1.8;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we add a bit of post processing. It is the first time
we talk about this, so let's details it a bit.
What is post processing (in a 3d context) ?
Post processing is performed after rendering the 3D, hence the name.
It applies on the screen as a whole. So the effects are in 2D.
What's it not ?
It isn't for 3d effect on specific objects in your world.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;tquery.effectcomposer.js&lt;/code&gt; plugin provides a simple api to add
postprocessing to our world. It is a chained API on top of
&lt;a href=&quot;https://github.com/mrdoob/three.js/tree/master/examples/js/postprocessing&quot;&gt;three.js effect composer&lt;/a&gt;.
In our case, we first apply &lt;code&gt;.sepia()&lt;/code&gt; to change the colors toward
&lt;a href=&quot;http://en.wikipedia.org/wiki/Sepia_(color)&quot;&gt;sepia color&lt;/a&gt;.
Then we apply &lt;code&gt;.vignette()&lt;/code&gt; for
&lt;a href=&quot;http://en.wikipedia.org/wiki/Vignetting&quot;&gt;Vignetting&lt;/a&gt;
and mark the effects list
as finished.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.addEffectComposer().sepia().vignette().finish();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Not too hard hey ;)&lt;/p&gt;

&lt;h2&gt;Hello Steve!&lt;/h2&gt;

&lt;p&gt;Now that we go a world. We will create a minecraft character.
In fact, minecraft main character is called &lt;a href=&quot;http://www.minecraftwiki.net/wiki/The_Player&quot;&gt;'steve'&lt;/a&gt;.
&lt;code&gt;tQuery.MinecraftChar&lt;/code&gt; is the main class. It will create
a character model and expose all its limbs too e.g right legs or right arms.
More on that later.
As you can see, we specify &lt;code&gt;skinUrl&lt;/code&gt; parameter. It should point to the
image of the skin texture. You can change it anytime with &lt;code&gt;character.loadSkin(skinUrl)&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var character   = new tQuery.MinecraftChar({
    skinUrl : 'images/3djesus.png'
}); 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now that we got our character setup, we just need to include it in our 3D world.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;character.model.addTo(world);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Make this model move&lt;/h2&gt;

&lt;p&gt;So we talked about exposed limbs... kinda gross, almost disturbing :)
In fact it just means each part of our model is exposed for you to
play with. It has the head, legs right and left, and the same for the arms.
It is all in &lt;code&gt;character.parts&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;So the first step is to hook a function in the world rendering loop.
two parameters are passed &lt;code&gt;delta&lt;/code&gt; and &lt;code&gt;now&lt;/code&gt;. &lt;code&gt;delta&lt;/code&gt; is the number
of seconds since the last iteration of the rendering loop. &lt;code&gt;now&lt;/code&gt; is the absolute
time in seconds.
We use those values to tune the animation. Thus it will be animated at the same
speed no matter the &lt;a href=&quot;http://en.wikipedia.org/wiki/Frame_rate&quot;&gt;fps&lt;/a&gt; rate of your computer.
Here is simple animation of the head. So we hook the function and change
the &lt;code&gt;headGroup&lt;/code&gt; rotation to fit our taste.
We will make it do an
&lt;a href=&quot;http://en.wikipedia.org/wiki/8_(number)&quot;&gt;eight&lt;/a&gt;
or
&lt;a href=&quot;http://en.wikipedia.org/wiki/Infinity#Infinity_symbol&quot;&gt;infinite synbol&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.loop().hook(function(delta, now){
    character.parts.headGroup.rotation.x    = Math.sin(now*1.5)/3;
    character.parts.headGroup.rotation.y    = Math.sin(now)/3;
}); 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;This is nice but the body would appear rather static if we move only the head.
Let's make see how to make it walk.
When people walks or run, they swing theirs arm and legs.
So we need to change the rotation X of each of those limbs. First we get
an angle relative to current time. It will determine the position of the arms/legs.
The amplitude of the move has been tuned to &lt;code&gt;1.4&lt;/code&gt;, play with it and find the
value you like. Then you move the legs and arms by setting the rotation.
Just take care of balancing legs and arms thus his can keep his balance :)&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.loop().hook(function(delta, now){
    var angle   = 1/2 * now*Math.PI*2;
    // move the arms
    character.parts.armR.rotation.x = 1.4 * Math.cos(angle + Math.PI);
    character.parts.armL.rotation.x = 1.4 * Math.cos(angle);
    // move the legs
    character.parts.legR.rotation.x = 1.4 * Math.cos(angle);
    character.parts.legL.rotation.x = 1.4 * Math.cos(angle + Math.PI);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;And we are done! Pretty cool no ? :)&lt;/p&gt;

&lt;h3&gt;Conclusion&lt;/h3&gt;

&lt;p&gt;So we did a little character ala minecraft.
We got a basic animations of it. Nevertheless it would be neat to make animations
more robusts and generic. A new post will likely focus on this.
I so love this field and how it make things easier.&lt;/p&gt;

&lt;p&gt;That's all folks. Have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>3D Physics With Three.js and Physijs</title>
    <link href="http://learningthreejs.com/blog/2012/06/05/3d-physics-with-three-js-and-physijs/"/>
    <updated>2012-06-05T12:13:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2012/06/05/3d-physics-with-three-js-and-physijs</id>
    <content type="html">&lt;p&gt;This is yet another post about physics.
This one is about
&lt;a href=&quot;https://github.com/chandlerprall/Physijs&quot;&gt;physijs&lt;/a&gt;
by
&lt;a href=&quot;https://twitter.com/#!/chandlerprall&quot;&gt;Chandler Prall&lt;/a&gt;.
It easily bind
&lt;a href=&quot;https://github.com/kripken/ammo.js/&quot;&gt;ammo.js&lt;/a&gt;
and
&lt;a href=&quot;http://mrdoob.github.com/three.js/&quot;&gt;three.js&lt;/a&gt;.
We will walk thru an example using it.
Physics is always important in 3D graphics.
It makes scenes more realistic.
Additionally, if you simple put your object into the scene, it will move nicely and realisticly.
So you spend less time tuning each moves. I am quite lazy so it matters :)
The &lt;a href=&quot;http://www.youtube.com/watch?v=THI82Q-P8Fo&quot;&gt;screencast&lt;/a&gt;
presents the &lt;a href=&quot;http://learningthreejs.com/data/2012-06-05-3d-physics-with-three-js-and-physijs/&quot;&gt;demo we gonna code&lt;/a&gt;
and various examples of what is possible with
&lt;a href=&quot;https://github.com/kripken/ammo.js/&quot;&gt;ammo.js&lt;/a&gt;.&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/THI82Q-P8Fo&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;




&lt;!-- more --&gt;


&lt;h2&gt;What About Physics Engines ?&lt;/h2&gt;

&lt;p&gt;We already did physics with three.js.
It was with &lt;a href=&quot;https://github.com/jeromeetienne/microphysics.js&quot;&gt;microphysics.js&lt;/a&gt; for &lt;a href=&quot;http://marblesoccer.com&quot;&gt;marblesoccer&lt;/a&gt; minigame.
It is a micro library implementing 3D physics.
We talked quite a bit about it in
&lt;a href=&quot;http://learningthreejs.com/blog/2011/10/17/lets-make-a-3d-game-microphysics-js/&quot;&gt;&quot;Lets Make a 3D Game: microphysics.js&quot;&lt;/a&gt;
and
&lt;a href=&quot;http://learningthreejs.com/blog/2011/11/02/lets-make-a-3d-game-helper-for-microphysics-js/&quot;&gt;&quot;Lets Make a 3D Game: microphysics.js, Even Easier&quot;&lt;/a&gt;.
It is only 500lines!
Unfortunatly, this tiny size comes limitations.&lt;/p&gt;

&lt;p&gt;Today we gonna use &lt;a href=&quot;https://github.com/chandlerprall/Physijs&quot;&gt;physijs&lt;/a&gt; by &lt;a href=&quot;https://twitter.com/#!/chandlerprall&quot;&gt;Chandler Prall&lt;/a&gt;.
This is a nice library which make it easy to use
&lt;a href=&quot;https://github.com/kripken/ammo.js/&quot;&gt;ammo.js&lt;/a&gt;
with
&lt;a href=&quot;http://mrdoob.github.com/three.js/&quot;&gt;three.js&lt;/a&gt;.
ammo.js is &quot;Direct port of the Bullet physics engine to JavaScript using
&lt;a href=&quot;https://github.com/kripken/emscripten&quot;&gt;Emscripten&lt;/a&gt;.
The source code is translated directly to JavaScript, without human rewriting, so functionality should be identical to the original Bullet.&quot;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://bulletphysics.org/&quot;&gt;bullet&lt;/a&gt; is a full-blown physics engine well-known in the 3D community.
It can do a lot as you can see in its &lt;a href=&quot;http://bulletphysics.com/Bullet/BulletFull/&quot;&gt;docs&lt;/a&gt;.
&lt;a href=&quot;https://github.com/kripken/ammo.js/&quot;&gt;ammo.js&lt;/a&gt;
supports all the features you can expect from a mature 3D physics engine.
Charles J. Cliffe, aka &lt;a href=&quot;https://twitter.com/#!/ccliffe&quot;&gt;@ccliffe&lt;/a&gt;,
did several demos using ammo.js.
This one is a &lt;a href=&quot;http://cjcliffe.github.com/CubicVR.js/cubicvr/samples/physics/physics_heightfield.html&quot;&gt;heighfield&lt;/a&gt;
And look at this &lt;a href=&quot;http://cjcliffe.github.com/CubicVR.js/cubicvr/samples/vehicle_physics_demo/stunt_track1.html&quot;&gt;stunt track&lt;/a&gt;!
Both are on top of &lt;a href=&quot;http://www.cubicvr.org/&quot;&gt;cubicvr&lt;/a&gt;, &lt;a href=&quot;https://twitter.com/#!/ccliffe&quot;&gt;@ccliffe&lt;/a&gt; own library.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/chandlerprall/Physijs&quot;&gt;physijs&lt;/a&gt; has been written with performance in mind.
&lt;a href=&quot;https://github.com/kripken/ammo.js/&quot;&gt;ammo.js&lt;/a&gt; is running in a
&lt;a href=&quot;https://developer.mozilla.org/En/Using_web_workers&quot;&gt;webworker&lt;/a&gt;.
So it most likely run on a second CPU. This is twice more cpu power for your javascript!
Coordinates are exchanged with
&lt;a href=&quot;http://updates.html5rocks.com/2011/12/Transferable-Objects-Lightning-Fast&quot;&gt;transferable objects&lt;/a&gt;
when available.
Transferable objects is a special type of object which can be transfered between the main thread and the worker &lt;strong&gt;without copying&lt;/strong&gt;
the data. Thus no matter how large the data are, it will be very low latency.&lt;/p&gt;

&lt;h2&gt;Lets Get Started&lt;/h2&gt;

&lt;p&gt;The code of today is a copy of the
&lt;a href=&quot;http://chandlerprall.github.com/Physijs/examples/collisions.html&quot;&gt;collision example&lt;/a&gt;
from
&lt;a href=&quot;http://chandlerprall.github.com/Physijs/&quot;&gt;physijs&lt;/a&gt;
using it thru tQuery API.
It may usefull to reimplement the same thing, just to be sure they both perform the same way. :)
&lt;a href=&quot;http://learningthreejs.com/data/2012-06-05-3d-physics-with-three-js-and-physijs/&quot;&gt;Try it out&lt;/a&gt;.
So we got object falling on the ground and slightly bouncing on it. Let's do just that.&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;100%&quot; height=&quot;420&quot; src=&quot;http://learningthreejs.com/data/2012-06-05-3d-physics-with-three-js-and-physijs/&quot; frameborder=&quot;0&quot; allowfullscreen webkitallowfullscreen mozallowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;p&gt;First a classic. We create a tQuery.World. So you immediatly got
a scene, a renderer, camera and its controls. All that already
setup according to reasonable default.
&lt;code&gt;.boilerplate()&lt;/code&gt; adds
the &lt;a href=&quot;http://learningthreejs.com/blog/2011/12/20/boilerplate-for-three-js/&quot;&gt;&quot;three.js boilerplate&quot;&lt;/a&gt;
we did last year. We disable the camera controls as it will stay still in this scene.
Then we &lt;code&gt;.start()&lt;/code&gt; to launch the render loop.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var world   = tQuery.createWorld().boilerplate({cameraControls: false}).start();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we setup the camera to be a bit far from the scene center. Thus
we got room to display larger objects&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.tCamera().position.set( 70, 40, 70 );
world.tCamera().lookAt( world.tScene().position );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we need to tell the renderer that shadow has to be casted. This is done by the simple lines below.
We saw the details in &lt;a href=&quot;http://learningthreejs.com/blog/2012/01/20/casting-shadows/&quot;&gt;&quot;Casting Shadows&quot;&lt;/a&gt; post.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.tRenderer().shadowMapEnabled  = true;
world.tRenderer().shadowMapSoft     = true;
world.tRenderer().setClearColorHex( 0xffffff, 1 );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we enable the physics into the world.
this is important. From now on, all the physics-enabled object
of this world will move according to realistic physics rules.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.enablePhysics();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Enlight your world&lt;/h2&gt;

&lt;p&gt;Here we setup the lights. For simplicity sake, we will use only one directional light.
First we tune the position and color to fit our tastes. Dont be shy, play with those parameters to get a feel of it.
Then we tune shadow parameters.
Those can be tricky to tune.
You can find more details in &lt;a href=&quot;http://learningthreejs.com/blog/2012/01/20/casting-shadows/&quot;&gt;&quot;Casting Shadow&quot;&lt;/a&gt; post.
It helps if you make the shaddow camera visible. You can do so with &lt;code&gt;.shadowCameraVisible(true)&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createDirectionalLight().addTo(world)
    .position(20, 40, -15).color(0xffffff)
    .castShadow(true).shadowMap(512*2,512*2)
    .shadowCamera(60, -60, 60, -60, 20, 200)
    .shadowDarkness(0.7).shadowBias(.002)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Let's create a ground to stand on&lt;/h2&gt;

&lt;p&gt;First we create the texture for our ground. We use &lt;code&gt;rocks.jpg&lt;/code&gt; to have like a rock
effect. We use &lt;code&gt;.RepeatWrapping&lt;/code&gt; to repeat the texture on the faces and get a
proper scale.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var texture = THREE.ImageUtils.loadTexture( &quot;images/rocks.jpg&quot; );
texture.wrapS   = texture.wrapT = THREE.RepeatWrapping;
texture.repeat.set( 3, 3 );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;In fact, the ground is only a cube which is wide and flat, a bit like
the &lt;a href=&quot;http://en.wikipedia.org/wiki/Flat_Earth&quot;&gt;old-vision of earth&lt;/a&gt; :)
It is usual now, we setup the position, material and shadow.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var ground  = tQuery.createCube(100, 1, 100).addTo(world)
    .position(0, -10, 0)
    .setLambertMaterial().map(texture).back()
    .receiveShadow(true)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we just have to setup the physics for the ground. This is done
by &lt;code&gt;.enablePhysics()&lt;/code&gt;. The &lt;code&gt;mass&lt;/code&gt; parameter define the mass
of the object in the physics.
By default, it is automatically computed depending on the volume of the object.
Here zeroing the mass is a special case, which say
&quot;the mass is infinite, dont move, ever&quot; :)&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ground.enablePhysics({
    mass    : 0
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Spawning object in a 3D world&lt;/h2&gt;

&lt;p&gt;Spawning is always a delicate matter in our world.
But first let's load the texture for the spawned objects.
It is done outside of the loop thus it get reused. Aka it is sent
only once to the GPU for all the objects. This is an important
point from performance point of view. Last year,
&lt;a href=&quot;http://learningthreejs.com/blog/2011/09/16/performance-caching-material/&quot;&gt;&quot;Performance: Caching Material&quot;&lt;/a&gt;
post was about this very topic.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var cTexture    = THREE.ImageUtils.loadTexture( &quot;images/plywood.jpg&quot; );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we declare &lt;code&gt;spawnObject()&lt;/code&gt; which gonna take care of spawning one object.
So we create a cube, setup its position, rotation and material. This is all good. Oh dont
forget to use &lt;code&gt;.castShadow()&lt;/code&gt; as got &lt;a href=&quot;http://en.wikipedia.org/wiki/Shadow_mapping&quot;&gt;shadow mapping&lt;/a&gt; going on :)&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var spawnObject = function(){
    var object  = tQuery.createCube(4,4,4).addTo(world)
        .rotation(Math.random()*Math.PI*2, Math.random()*Math.PI*2, Math.random()*Math.PI*2)
        .position(Math.random()*15-7.5, 25, Math.random()*15-7.5)
        .setLambertMaterial().map(cTexture).back()
        .castShadow(true)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Here we enable the physics on this object. So the world will handle all its move from now on.
It will object to physics laws according to the parameters you setup.
&lt;a href=&quot;http://en.wikipedia.org/wiki/Friction&quot;&gt;friction&lt;/a&gt; is the force resisting when 2 objects slides against each other.
&lt;a href=&quot;http://en.wikipedia.org/wiki/Coefficient_of_restitution&quot;&gt;resititution&lt;/a&gt; is how bouncy the object is.
For scientific definition, go read a book :)&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    object.enablePhysics({
        friction    : 0.4,
        restitution : 0.6
    });
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we gonna play with the 'collision' event. Physijs is able to notify
you when an object collide with another. Just use &lt;code&gt;.addEventListener()&lt;/code&gt; on 'collision'.
Here we gonna change the color of the object depending on the number of collisions
they got.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    var nCollisions = 0;
    object.physics().addEventListener('collision', function(){
        var colliColors = [0xcc8855, 0xbb9955, 0xaaaa55, 0x99bb55, 0x88cc55, 0x77dd55];
        if( ++nCollisions &amp;lt; colliColors.length ){
            var color   = colliColors[nCollisions];
            object.get(0).material.color.setHex( color );
        }
    })
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we simply use &lt;a href=&quot;https://developer.mozilla.org/en/DOM/window.setInterval&quot;&gt;&lt;code&gt;setInterval()&lt;/code&gt;&lt;/a&gt; to
spawn an object every seconds.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;setInterval(spawnObject, 1000);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;And we are DONE! We got a realistic physics in our 3D world! not bad hey :)&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;So, thanks to &lt;a href=&quot;https://github.com/chandlerprall/Physijs&quot;&gt;physijs&lt;/a&gt;,
it is now possible to get full blown realistic physics
using
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;
and
&lt;a href=&quot;https://github.com/jeromeetienne/tquery&quot;&gt;tQuery&lt;/a&gt;.
It is a simple way to make scene more realistic. It is nice to experiment with.
I will do more on this very soon!&lt;/p&gt;

&lt;p&gt;Thanks all folks! have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Three.js Sport Car on iOS at 40fps</title>
    <link href="http://learningthreejs.com/blog/2012/05/29/three-js-sportcar-on-ios/"/>
    <updated>2012-05-29T13:48:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2012/05/29/three-js-sportcar-on-ios</id>
    <content type="html">&lt;p&gt;This post is about iOS and three.js.
It may seem surprising, but &lt;a href=&quot;http://en.wikipedia.org/wiki/iOS&quot;&gt;iOS&lt;/a&gt; supports WebGL since version 4.2.
There is a tough limitation tho, it is available only in their advertisment plateform,
&lt;a href=&quot;http://en.wikipedia.org/wiki/IAd&quot;&gt;iAds&lt;/a&gt;, not in safari browser.
I got a ipad2 so i experimented a bit with three.js on iOS to see what is going on.
Most WebGL examples from
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt; and
&lt;a href=&quot;https://github.com/jeromeetienne/tquery&quot;&gt;tQuery&lt;/a&gt;
are working nicely on iOS.&lt;/p&gt;

&lt;p&gt;The
&lt;a href=&quot;http://www.youtube.com/watch?v=3yc4qhP87oY&quot;&gt;screencast&lt;/a&gt;
below shows an ipad2 running the car demo we did last week in
&lt;a href=&quot;http://learningthreejs.com/blog/2012/05/21/sport-car-in-webgl/&quot;&gt;&quot;Sport Car in WebGL&quot;&lt;/a&gt; post.
It runs at 40fps on the video. Rather good!
Especially when you know the demo isn't optimized.
This car is way too detailed.
One could reduce the size of this model by half without loosing much.
So on mobile, the Good part is that &lt;em&gt;fps are good&lt;/em&gt;.
The Bad part is that &lt;em&gt;speed is slower&lt;/em&gt; and &lt;em&gt;balanced differently&lt;/em&gt;.
This unbalanced part worries me a bit i admit. We need to better understand the mobile plateform.
But hey, 40fps is quite good, way enougth to make a game!&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/3yc4qhP87oY&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;




&lt;!-- more --&gt;


&lt;h2&gt;Experimenting with WebGL on iOS&lt;/h2&gt;

&lt;p&gt;Yesterday,
&lt;a href=&quot;http://news.ycombinator.com/user?id=daeken&quot;&gt;daeken&lt;/a&gt;
published a
&lt;a href=&quot;http://demoseen.com/webglenabler/#&quot;&gt;WebGL Enabler&lt;/a&gt;
for iOS.
It enables WebGL in the browser for jailbroken iOS devices.
Or if you prefere a less invasive solution, not requiring to jailbreak your devices.
You can use
&lt;a href=&quot;https://github.com/benvanik/WebGLBrowser&quot;&gt;WebGL Browser&lt;/a&gt;
made by
&lt;a href=&quot;http://noxa.org/&quot;&gt;Ben Vanik&lt;/a&gt;
, aka &lt;a href=&quot;https://twitter.com/#!/benvanik&quot;&gt;@benvanik&lt;/a&gt; on twitter.
He is wellknow for &lt;a href=&quot;https://github.com/benvanik/WebGL-Inspector&quot;&gt;WebGL Inspector&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;By the way,
&lt;a href=&quot;https://github.com/benvanik/WebGLBrowser&quot;&gt;WebGL Browser&lt;/a&gt;
and
&lt;a href=&quot;http://demoseen.com/webglenabler/#&quot;&gt;WebGL Enabler&lt;/a&gt;,
are both based on a similar trick.
It has been discovered by
&lt;a href=&quot;https://twitter.com/#!/atnan&quot;&gt;Nathan de Vries&lt;/a&gt;
who told about it in this
&lt;a href=&quot;http://atnan.com/blog/2011/11/03/enabling-and-using-webgl-on-ios/&quot;&gt;excelent post&lt;/a&gt;.
A very good read to understand the underlying details!
Unfortuntly this is using an unofficial API... so it is
impossible to get it for the apps store unfortunatly.&lt;/p&gt;

&lt;h2&gt;WebGL Status on Mobile&lt;/h2&gt;

&lt;p&gt;WebGL is starting to be hot on mobile.
&lt;a href=&quot;http://www.blackberry.com/playbook&quot;&gt;blackberry playbook2&lt;/a&gt;
got it
&lt;a href=&quot;http://devblog.blackberry.com/2012/02/playbook-native-webgl-development/&quot;&gt;by default&lt;/a&gt;.
&lt;a href=&quot;http://www.mozilla.org/en-US/b2g/&quot;&gt;boot on gecko&lt;/a&gt; got it too with firefox mobile.
It isn't enabled on android and iOS tho, the 2 majors.
Maybe we will have more info in june with
&lt;a href=&quot;https://developers.google.com/events/io/&quot;&gt;google.io&lt;/a&gt;
and
&lt;a href=&quot;https://developer.apple.com/wwdc/&quot;&gt;apple event&lt;/a&gt;.
google got &lt;a href=&quot;http://www.google.com/intl/en/chrome/android/&quot;&gt;chrome on android&lt;/a&gt;.
iOS already got &lt;a href=&quot;http://atnan.com/blog/2011/11/03/enabling-and-using-webgl-on-ios/&quot;&gt;support&lt;/a&gt;, this is more a matter of policy.
So lets hope google will announce WebGL support for chrome mobile.
and apple will announce they accepts WebGL on apps store applications.
I am an optimist personn, i hope :)&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;WebGL is coming hard on mobile.
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt; and
&lt;a href=&quot;https://github.com/jeromeetienne/tquery&quot;&gt;tQuery&lt;/a&gt;
already work on it.
We need the 2 majors mobile OS to support it tho.
It think having it on android and ios would significantly change WebGL landscape.
Meanwhile you can already play with it, and do minigames with it, thus be ready when needed :)&lt;/p&gt;

&lt;p&gt;That's all to today folks. Have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Sport Car in WebGL</title>
    <link href="http://learningthreejs.com/blog/2012/05/21/sport-car-in-webgl/"/>
    <updated>2012-05-21T12:16:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2012/05/21/sport-car-in-webgl</id>
    <content type="html">&lt;p&gt;This post is about sport cars and how cool they can be!
Once again, we gonna expose gems from three.js examples.
It contains several sport cars which are fun to play with.
You can drive them around and all.
This is a good base for a game.
We made tQuery plugins on top to make them easily reusable.
Our scene will be a nice sport car, a grass ground, a sunset sky with shadow casting.
All that in 40-lines of javascript.&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/KxRfFd9SM5s&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;




&lt;!-- more --&gt;


&lt;h2&gt;What We Gonna Build ?&lt;/h2&gt;

&lt;p&gt;What you see below is what we gonna build. Pretty nice no ?
&lt;a href=&quot;http://learningthreejs.com/data/2012-05-21-sport-car-in-webgl/&quot;&gt;Try it out&lt;/a&gt;.&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;100%&quot; height=&quot;420&quot; src=&quot;http://learningthreejs.com/data/2012-05-21-sport-car-in-webgl/&quot; frameborder=&quot;0&quot; allowfullscreen webkitallowfullscreen mozallowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;p&gt;It shows what is possible with &lt;code&gt;tquery.car.js&lt;/code&gt;.
It is a plugin provides rendering and controls of sport cars.
It is heavily based on some examples by &lt;a href=&quot;http://alteredqualia.com/&quot;&gt;alteredq&lt;/a&gt; in
&lt;a href=&quot;http://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;.
You can find them
&lt;a href=&quot;http://mrdoob.github.com/three.js/examples/webgl_materials_cars.html&quot;&gt;here&lt;/a&gt;
and
&lt;a href=&quot;http://mrdoob.github.com/three.js/examples/webgl_materials_cubemap_dynamic.html&quot;&gt;here&lt;/a&gt;.
The car is a Bugatti Veyron model by
&lt;a href=&quot;http://artist-3d.com/free_3d_models/dnm/model_disp.php?uid=1129&quot;&gt;Troyano&lt;/a&gt;.
Now let's get started.&lt;/p&gt;

&lt;h2&gt;Let's start coding&lt;/h2&gt;

&lt;p&gt;We start to create our world as usual. We enable the
&lt;a href=&quot;http://learningthreejs.com/blog/2011/12/20/boilerplate-for-three-js/&quot;&gt;boilerplate for three.js&lt;/a&gt;.
It is a fast way start, avoids repetitive tasks, following DRY principles and includes all those good practices which are so easy to forget.
Then we just have to &lt;code&gt;.start()&lt;/code&gt; the rendering loop on this world.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var world   = tQuery.createWorld().boilerplate().start();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we setup the renderer.
In this scene, we want to cast shadows as if it cames from the sun.
This is a nice way to improve the realism in our 3D scene
We already talked about it in &lt;a href=&quot;http://learningthreejs.com/blog/2012/01/20/casting-shadows/&quot;&gt;&quot;Casting Shadow&quot;&lt;/a&gt;
The renderer needs to be notified so we set &lt;code&gt;.shadowMapEnabled&lt;/code&gt; and &lt;code&gt;.shadowMapSoft&lt;/code&gt; to true.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.renderer().shadowMapEnabled   = true;
world.renderer().shadowMapSoft      = true;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;The Sky&lt;/h2&gt;

&lt;p&gt;Now we add a sky to the 3D scene.
It will fill the space and make the scene more realistic.
We use a skymap for that. It is WebGL trick which take a cube, make it so large that it seems infinite.
On it, we map a 360degeree texture shaped as a cube, and use a special shader to display it. All is in this
shader, it makes the cube appear as if we were in a gigantic sphere. Exactly like we would feel with a sky above
our head.
We already saw skymaps in &lt;a href=&quot;http://learningthreejs.com/blog/2011/08/15/lets-do-a-sky/&quot;&gt;&quot;let's do a sky&quot;&lt;/a&gt; post.
We just added a new plugins &lt;code&gt;tquery.skymap.js&lt;/code&gt;.
It avoids repeative code when you do skymap or environement map.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createSkymap('skybox').addTo(world);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;The Lights&lt;/h2&gt;

&lt;p&gt;Here we setup the lights. We put one ambient and 2 directional lights.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createAmbientLight().addTo(world).color(0xFFFFFF);
tQuery.createDirectionalLight().addTo(world).position(1,1,-1).color(0xffffff).intensity(2);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;It is rather simple so lets focus on the last one, the one casting shadow.
We want it to appear as coming from the sun.
So we look at the skymap and approximatly localized the sun at &lt;code&gt;(-10, 20, 30)&lt;/code&gt;.
Then we tune shadow parameters to fit our tastes.
You can find more details in &lt;a href=&quot;http://learningthreejs.com/blog/2012/01/20/casting-shadows/&quot;&gt;&quot;Casting Shadow&quot;&lt;/a&gt; post.
Those parameters can be tricky to tune. It helps if you make the shaddow
camera visible. You can do so with &lt;code&gt;.shadowCameraVisible(true)&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createDirectionalLight().addTo(world).position(-10, 20, 30).color(0xffffff).intensity(4)
    .castShadow(true).shadowDarkness(0.8)
    .shadowMap(512*2,512*2)
    .shadowCamera(10, -10, 20, -20, 0.1, 50);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;The Ground&lt;/h2&gt;

&lt;p&gt;Now we add the ground. A car needs a ground to stand on :)
For that, we got a little helper &lt;code&gt;tquery.grassground.js&lt;/code&gt;.
This is just building a &lt;code&gt;THREE.Plane&lt;/code&gt; and mapping a grass
texture into it.
It does the job for a simple and fast ground.
We have seen something similar with &lt;code&gt;tquery.checkerboard.js&lt;/code&gt; in
&lt;a href=&quot;http://learningthreejs.com/blog/2012/05/04/tquery-md2character-a-plugin-for-doom-characters/&quot;&gt;&quot;tQuery Plugin for Doom Characters&quot;&lt;/a&gt;
post.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var ground  = tQuery.createGrassGround({
    textureUrl  : '../../grassground/images/grasslight-big.jpg',
    textureRepeatX  : 30,
    textureRepeatY  : 30,       
}).addTo(world).receiveShadow(true).scaleBy(100);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;The Car&lt;/h2&gt;

&lt;p&gt;First we instanciate a &lt;code&gt;tQuery.Car&lt;/code&gt; object with &lt;code&gt;tQuery.createCar()&lt;/code&gt;.
It will load the models, then material will be setup.
&lt;code&gt;tQuery.Car&lt;/code&gt; handles the displacement of the car too.
You can make the car turn, go forward and backward, using &lt;code&gt;car.controls()&lt;/code&gt;.
you can even switch on/off the lights with &lt;code&gt;.flareVisible()&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var car = tQuery.createCar();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Then we had the car model in our world scene. Important if you want to see it :)&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.add(car.model())
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we got the car on the scene, this is all good.
But we need the camera to follow this car. We create a camera controls specific
to mimic the usual camera in car game. The camera is placed a bit behind the car and looks forward.
The faster you go, the further you look. This is always nice to see what is coming at you :)&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.Car.createCameraControls(car, world);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Car Controls&lt;/h2&gt;

&lt;p&gt;Now we hook the controls to the car. This determines how the player will control the
car. It can be controlled by the keyboard, so users press arrows on keyboard
and the car moves.
It can be controlled by the &lt;a href=&quot;http://dev.w3.org/geo/api/spec-source-orientation.html&quot;&gt;device orientation&lt;/a&gt;.
We already talked device orientation in game in
&lt;a href=&quot;http://learningthreejs.com/blog/2011/09/20/lets-make-a-3D-game-device-orientation/&quot;&gt;this post&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var hasTouchEvent   = &quot;ontouchstart&quot; in window;
if( hasTouchEvent ) car.hookDeviceOrientation();
else            car.hookKeyboard();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now maybe you wonder &quot;why this devices orientation&quot; ?
I ported tQuery to IOS. So since tQuery r49.1, it is possible to run
tquery on your iphones or ipads.
It is possible to render with &lt;a href=&quot;http://www.w3.org/TR/2dcontext/&quot;&gt;canvas 2D&lt;/a&gt; in the regular browser.
Even possible to render WebGL using
&lt;a href=&quot;https://github.com/benvanik/WebGLBrowser&quot;&gt;WebGL Browser&lt;/a&gt; by &lt;a href=&quot;https://twitter.com/#!/benvanik&quot;&gt;Ben Vanik&lt;/a&gt;.&lt;/p&gt;

&lt;h2&gt;The Road&lt;/h2&gt;

&lt;p&gt;In a scene, it is cool to create a goal, something for the user to do.
A road seems like a perfect goal for a car :)
First we create the material we gonna use. This is a &lt;a href=&quot;http://en.wikipedia.org/wiki/Lambertian_reflectance&quot;&gt;lambert&lt;/a&gt;
with a &lt;a href=&quot;http://en.wikipedia.org/wiki/Reflection_mapping&quot;&gt;reflection&lt;/a&gt;. You put a cube texture in the
&lt;code&gt;envMap&lt;/code&gt; parameter and you got your reflection :) Here again, we use tquery.skymap.js to create the cube texture.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var material    = new THREE.MeshLambertMaterial({
    ambient : 0x444444,
    color   : 0x666666,
    envMap  : tQuery.createCubeTexture('skybox')
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we add the arches. In fact, they are torus which are half in the ground, so the
visible part looks like an arche.
We put 5 of them along the Z axis.
They are all aligned to give a kindof road.
&lt;code&gt;.castShadow(true)&lt;/code&gt; make the 3D object as casting shadow. Always a nice trick to enhance realism.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;for(var i = 0; i &amp;lt; 5; i++){
    tQuery.createTorus(1.25-0.25, 0.25, 8, 6*4, material).addTo(world)
        .castShadow(true).translateZ( 2 + i * 5 );      
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;And we are &lt;strong&gt;DONE&lt;/strong&gt;! We got a nice looking car, driving on grass with a sun set. It is
controlled by keyboard and the camera controls is suitable for a game. Not bad
for 40 lines of javascript.&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;In this post, i walked you thru a example of &lt;code&gt;tQuery.car.js&lt;/code&gt;. It builds a rather
cool scene in 40lines of js. It seems a nice base for a game. Like the
&lt;a href=&quot;http://learningthreejs.com/blog/2012/05/15/punch-a-doom-character-in-augmented-reality/&quot;&gt;two&lt;/a&gt;
&lt;a href=&quot;http://learningthreejs.com/blog/2012/05/08/sound-visualisation-vuemeter-in-webgl/&quot;&gt;previous&lt;/a&gt;
walk through, we got very short code. I like this, it makes it easier to understand
and learn. WebGL for All!! :)&lt;/p&gt;

&lt;p&gt;That's all folks! have fun.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Punch A Doom Character in Augmented Reality</title>
    <link href="http://learningthreejs.com/blog/2012/05/15/punch-a-doom-character-in-augmented-reality/"/>
    <updated>2012-05-15T11:59:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2012/05/15/punch-a-doom-character-in-augmented-reality</id>
    <content type="html">&lt;p&gt;Did you ever dreamed of punching a doom character ? They look evil and killed
you so many time while you were playing the game. It is revenge time! This
post will help you realize your dream :)
It is about a minigame called &quot;Punch A Doom Character in Augmented Reality&quot;
because in this game, the player can punch Doom Character in augmented reality :)&lt;/p&gt;

&lt;p&gt;The character is displayed in 3D with WebGL with &lt;a href=&quot;http://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;.
The player gestures are recognized thru the webcam by &lt;a href=&quot;https://github.com/jeromeetienne/augmentedgesture.js&quot;&gt;augmentedgesture.js&lt;/a&gt; library.
It uses &lt;a href=&quot;http://webrtc.org&quot;&gt;WebRTC&lt;/a&gt; &lt;a href=&quot;http://dev.w3.org/2011/webrtc/editor/getusermedia.html&quot;&gt;getUserMedia&lt;/a&gt; to get the webcam
using open standards.
You can play this minigame &lt;a href=&quot;http://learningthreejs.com/data/2012-05-15-punch-a-doom-character-in-augmented-reality&quot;&gt;here&lt;/a&gt;.
In fact, it is an example of &lt;a href=&quot;https://github.com/jeromeetienne/augmentedgesture.js&quot;&gt;augmentedgesture.js&lt;/a&gt; library.
We will walk you thru the code. Only 60 lines of Javascript.&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/Aa9945MGRL0&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;




&lt;!-- more --&gt;


&lt;p&gt;We have seen augmented gesture in &lt;a href=&quot;http://learningthreejs.com/blog/2012/05/02/augmented-reality-3d-pong/&quot;&gt;&quot;Augmented Reality 3D Pong&quot;&lt;/a&gt; post
and MD2 Characters in &lt;a href=&quot;http://learningthreejs.com/blog/2012/05/04/tquery-md2character-a-plugin-for-doom-characters/&quot;&gt;&quot;tQuery Plugin for Doom Characters&quot;&lt;/a&gt; post.
Now we gonna associate them together in our mini game :)
I presented it at &lt;a href=&quot;www.web-5.org&quot;&gt;Web-5&lt;/a&gt; conference in april.
At the time, i recorded a preview &lt;a href=&quot;http://www.youtube.com/watch?v=hUYM93xaIgg&quot;&gt;&quot;Doom: a new workout for geek?&quot;&lt;/a&gt;.
Now let's get started!&lt;/p&gt;

&lt;h2&gt;The 3D World&lt;/h2&gt;

&lt;p&gt;First we initialize the world in 3D.
With &lt;code&gt;tQuery.createWorld()&lt;/code&gt;, we create a &lt;code&gt;tQuery.World&lt;/code&gt;.
With &lt;code&gt;.boilerplate()&lt;/code&gt;, we setup a boilerplate on this world. A boilerplate is
a fast way to get you started on the right foot. It is the
&lt;a href=&quot;http://learningthreejs.com/blog/2011/12/20/boilerplate-for-three-js/&quot;&gt;learningthreejs boilerplate for three.js&lt;/a&gt;.
With &lt;code&gt;.start()&lt;/code&gt;, we start the rendering loop. So from now on, the world scene
gonna be rendered periodically, typically 60time per seconds.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var world   = tQuery.createWorld().boilerplate().start();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;We setup the camera now. We remove the default camera controls from the boilerplate.
Then we put the camera at &lt;code&gt;(0,1.5,5)&lt;/code&gt; and looking toward &lt;code&gt;(0,1,-1)&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.removeCameraControls()
world.camera().position.set(0,1.5, 4);
world.camera().lookAt(new THREE.Vector3(0,1,-1));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we change the background color. This confusing line ensure the background of the
3D scene will be rendered as &lt;code&gt;0x000000&lt;/code&gt; color, aka black. We set a black
background to give an impression of night.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.renderer().setClearColorHex( 0x000000, world.renderer().getClearAlpha() );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;We had a fog to the scene. For that, we use &lt;code&gt;tquery.world.createfog.js&lt;/code&gt; plugins.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.addFogExp2({density : 0.15});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3&gt;The Lights&lt;/h3&gt;

&lt;p&gt;Here we setup the lights of our scene. This is important as it determine how
your scene looks. We add a ambient light and a directional light.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createAmbientLight().addTo(world).color(0x444444);
tQuery.createDirectionalLight().addTo(world).position(-1,1,1).color(0xFFFFFF).intensity(3);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3&gt;The Ground&lt;/h3&gt;

&lt;p&gt;We create a large checkerboard with &lt;code&gt;tquery.checkerboard.js&lt;/code&gt; plugin.
We scale the checkerboard to 100 per 100 units in the 3D world. Thus it is
quite large and disappears into the fog. It gives the cheap impression of
an infinite checkerboard.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createCheckerboard({
    segmentsW   : 100,  // number of segment in width
    segmentsH   : 100   // number of segment in Height
}).addTo(world).scaleBy(100);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3&gt;The Character&lt;/h3&gt;

&lt;p&gt;We use &lt;code&gt;tQuery.RatamahattaMD2Character&lt;/code&gt; plugin. Its inherits from
&lt;code&gt;tQuery.MD2Character&lt;/code&gt; plugin. All the configuration for this particular
character &lt;code&gt;ratamahatta&lt;/code&gt; is already done for you.
We attach it to tQuery world.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var character   = new tQuery.RatamahattaMD2Character().attach(world);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;When an animation is completed, switch to animation 'stand'.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;character.bind('animationCompleted', function(character, animationName){
    console.log(&quot;anim completed&quot;, animationName);
    this.animation('stand');
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Recognize Augmented Gestures&lt;/h2&gt;

&lt;p&gt;First we instanciate an object of &lt;strong&gt;AugmentedGesture&lt;/strong&gt; class.
&lt;code&gt;.enableDatGui()&lt;/code&gt; will add a &lt;a href=&quot;http://workshop.chromeexperiments.com/examples/gui&quot;&gt;Dat.GUI&lt;/a&gt;.
This is a nice library to tune parameters. We use it to tune augmentedgesture pointers.
You can read more about it in &lt;a href=&quot;http://learningthreejs.com/blog/2011/08/14/dat-gui-simple-ui-for-demos/&quot;&gt;&quot;Dat-gui - Simple UI for Demos&quot;&lt;/a&gt; post.
&lt;code&gt;.start()&lt;/code&gt; asks it to begin monitoring the webcam and see if it finds markers.
&lt;code&gt;.domElementThumbnail()&lt;/code&gt; put the webcam view as a thumbnail on the screen. This is what you
see on top-left.
This is usefull for the user, it is used as feedback to know what is happening&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var aGesture    = new AugmentedGesture().enableDatGui().start().domElementThumbnail();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3&gt;The Pointers&lt;/h3&gt;

&lt;p&gt;Now that we got our AugmentedGesture instance, we gonna configure the pointers.
One for the right hand, one for the left hand. For each, we setup the options
to adapt each hand colors.
In my case, the right hand is containing a green ball and the left hand contains a red ball.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var pointerOpts = new AugmentedGesture.OptionPointer();
pointerOpts.pointer.crossColor  = {r:    0, g: 255, b:   0};
pointerOpts.colorFilter.r   = {min:   0, max:  95};
pointerOpts.colorFilter.g   = {min: 115, max: 255};
pointerOpts.colorFilter.b   = {min:  25, max: 150};
aGesture.addPointer(&quot;right&quot;, pointerOpts);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we do the same for the left pointer.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var pointerOpts = new AugmentedGesture.OptionPointer();
pointerOpts.pointer.crossColor  = {r:    255, g:   0, b: 128};
pointerOpts.colorFilter.r   = {min: 190, max: 255};
pointerOpts.colorFilter.g   = {min:  30, max: 255};
pointerOpts.colorFilter.b   = {min:   0, max: 100};
aGesture.addPointer(&quot;left&quot;, pointerOpts);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3&gt;Gesture Analysis&lt;/h3&gt;

&lt;p&gt;Now that augmentedgesture.js is giving us the position of each hand, we gonna
convert that into events. &lt;code&gt;punchingRight&lt;/code&gt; when the user gives a punch with
the right hand and &lt;code&gt;punchingLeft&lt;/code&gt; for the left hand.
We establish a variable to store the user moves. It is quite simple
&lt;code&gt;.punchingRight&lt;/code&gt; is true when the use is punching with his right hand.
&lt;code&gt;.punchingLeft&lt;/code&gt; is the same for the left hand.
and &lt;code&gt;.changed&lt;/code&gt; is true when values change.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var userMove    = {
    punchingRight   : false,
    punchingLeft    : false,
    changed     : false
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;we bind the event &lt;code&gt;mousemove.left&lt;/code&gt; thus we are notified when the user moves his
left hand. The algo we use is very simple: if the left hand is on the right part of
the screen, then the user is considered &quot;punchingLeft&quot;. Dont forget
to &lt;code&gt;.changed&lt;/code&gt; to true&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;aGesture.bind(&quot;mousemove.left&quot;, function(event){
    var state   = event.x &amp;gt; 1 - 1/3;
    if( state === userMove.punchingLeft )   return;
    userMove.punchingLeft   = state;
    userMove.changed    = true;
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we need the same thing for the other hand. all the the same.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;aGesture.bind(&quot;mousemove.right&quot;, function(event){
    var state   = event.x &amp;lt; 1/3;
    if( state === userMove.punchingRight )  return;
    userMove.punchingRight  = state;
    userMove.changed    = true;
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Bind Character and Augmented Gestures&lt;/h2&gt;

&lt;p&gt;Now we hook a function to the rendering loop. This function will be executed
every time the scene is renderered. The first thing we do in this function
is to check that userMove has &lt;code&gt;.changed&lt;/code&gt;. If not, we do nothing.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.loop().hook(function(){
    if( userMove.changed === false )    return;
    userMove.changed = false;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we process each move of the user. If the user is &lt;code&gt;punchingRight&lt;/code&gt;, play
the animation &lt;code&gt;crdeath&lt;/code&gt; of the character. If he is &lt;code&gt;punchingLeft&lt;/code&gt;,
play &lt;code&gt;crplain&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    if( userMove.punchingRight )        character.animation('crdeath');
    else if( userMove.punchingLeft )    character.animation('crpain');
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;And you are &lt;strong&gt;DONE&lt;/strong&gt;! Pretty nice no ? :)&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;In this post we built a mini-game where users can punch doom character in augmented reality.
All that in 60 lines of javascript.
The Character is displayed in WebGL with
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;
and the augmented reality is handled
by &lt;a href=&quot;https://github.com/jeromeetienne/augmentedgesture.js&quot;&gt;augmentedgesture.js&lt;/a&gt;.
I like how those libraries makes the code so small, and the developement time
so short.&lt;/p&gt;

&lt;p&gt;That's all folks, have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Sound Visualisation: a Vuemeter in WebGL</title>
    <link href="http://learningthreejs.com/blog/2012/05/08/sound-visualisation-vuemeter-in-webgl/"/>
    <updated>2012-05-08T10:32:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2012/05/08/sound-visualisation-vuemeter-in-webgl</id>
    <content type="html">&lt;p&gt;This post is about producing a 3D Vuemeter for real time sound.
We gonna walk thru the code of a
&lt;a href=&quot;https://github.com/jeromeetienne/webaudio.js&quot;&gt;webaudio.js&lt;/a&gt; example.
This example will show you how to create a WebGL vuemetter with
&lt;a href=&quot;https://github.com/jeromeetienne/webaudio.js&quot;&gt;webaudio.js&lt;/a&gt;.
It should be simple to understand, only 40-lines of javascript.
&lt;a href=&quot;https://github.com/jeromeetienne/webaudio.js&quot;&gt;webaudio.js&lt;/a&gt; is a web audio library
for game. We gonna use it to reach &lt;a href=&quot;https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html&quot;&gt;Web Audio API&lt;/a&gt;.
We gonna use &lt;a href=&quot;https://github.com/jeromeetienne/tquery&quot;&gt;tQuery&lt;/a&gt;
to reach &lt;a href=&quot;http://github.com/mrdoob/three.js/&quot;&gt;three.js 3D engine&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;webaudio.js&lt;/code&gt; has been first coded as a tQuery plugin.
You can find a &lt;a href=&quot;http://learningthreejs.com/blog/2012/03/20/sounds-for-more-realistic-3d/&quot;&gt;post about it&lt;/a&gt;
on &lt;a href=&quot;http://learningthreejs.com&quot;&gt;learningthreejs&lt;/a&gt; blog.
But this technology is so nice, it deserved its &lt;a href=&quot;https://github.com/jeromeetienne/webaudio.js&quot;&gt;own repository&lt;/a&gt;.
The library gained in flexibility in the process: It is now possible to display histogram in canvas2D
of simply play sound, with no 3D at all :) see &lt;a href=&quot;http://jeromeetienne.github.com/webaudio.js/#examples&quot;&gt;here&lt;/a&gt; for a list of
webaudio.js examples.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jeromeetienne.github.com/webaudio.js/examples/histotquery.html&quot;&gt;Try the demo&lt;/a&gt;.
This is the result that we gonna build together.
Below is a small &lt;a href=&quot;http://www.youtube.com/watch?v=--Gv2EI2a-U&quot;&gt;screencast&lt;/a&gt; of me presenting the code.&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/--Gv2EI2a-U&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;




&lt;!-- more --&gt;


&lt;h2&gt;Background Knowledge&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Web Audio API&lt;/strong&gt; is aimed for games and based on openAL.
Its API is real nice tho. It is Efficient and flexible.
It is efficient because most processing happen in native code,
still you configure it in js, your favorite language :)
It is flexible as it is based on a routing concept which
give you great controls on the sounds you play.&lt;/p&gt;

&lt;p&gt;You can find
&lt;a href=&quot;http://www.html5rocks.com/en/tutorials/#technology:multimedia&quot;&gt;many good tutorials&lt;/a&gt;
on the matter on
&lt;a href=&quot;http://www.html5rocks.com/en/&quot;&gt;html5rocks&lt;/a&gt;.
I recently did a presentation at &lt;a href=&quot;http://www.musichackparis.org&quot;&gt;musichackparis&lt;/a&gt; on Web Audio API.
If you want to know more, slides are &lt;a href=&quot;http://jeromeetienne.github.com/slides/webaudioapi&quot;&gt;here&lt;/a&gt;.
This API is available on WebKit based browser, so safari and chrome and its derivative.
Unfortunatly this API isn't compatible with major webgl browsers e.g. firefox and opera.
The &lt;strong&gt;Web Audio API&lt;/strong&gt; is real nice tho. Efficient flexible
Sound is still the poor lone child of the web :(
Well let's have fun with what we have.&lt;/p&gt;

&lt;h2&gt;Let's get started&lt;/h2&gt;

&lt;p&gt;Ok the very begining is real simple. We init a basic html page.
Then we include the dependancies in javascript.
We include &lt;a href=&quot;https://github.com/jeromeetienne/webaudio.js&quot;&gt;webaudio.js&lt;/a&gt; to handle the sound playing and analysis.
Then we just have to include &lt;a href=&quot;https://github.com/jeromeetienne/tquery&quot;&gt;tquery&lt;/a&gt;.
tquery-bundle.js is &lt;a href=&quot;https://github.com/jeromeetienne/tquery&quot;&gt;tquery&lt;/a&gt;
bundled with
&lt;a href=&quot;http://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt; in a single file for convenience.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;!doctype html&amp;gt;&amp;lt;title&amp;gt;webaudio example: histo3d&amp;lt;/title&amp;gt;
&amp;lt;script src=&quot;../build/webaudio.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script src=&quot;vendor/tquery/tquery-bundle.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;body&amp;gt;&amp;lt;script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Let's Code in JS&lt;/h2&gt;

&lt;p&gt;First we gonna intenciate &lt;code&gt;WebAudio&lt;/code&gt;. This will initialize the layer.
It will create the &lt;a href=&quot;https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#AudioNode-section&quot;&gt;AudioNode&lt;/a&gt;`s
for the end of the chain.
By default it contains a
&lt;a href=&quot;https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#AudioGainNode&quot;&gt;gainNode&lt;/a&gt;
and a
&lt;a href=&quot;https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#DynamicsCompressorNode&quot;&gt;compressorNode&lt;/a&gt;.
The gainNode is used to tune the volume. and the compressNode to smooth the peaks we could
hit in the sound.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var webaudio    = new WebAudio();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now that we go webaudio available, let's use it to create the sound we gonna play.
&lt;code&gt;.createSound()&lt;/code&gt; will create a &lt;code&gt;WebAudio.Sound&lt;/code&gt;. Then we &lt;code&gt;.load()&lt;/code&gt; it
from this url 'sounds/perfume.mp3'. The callback will be notified as soon as the sound
is loaded. Then we simply start to play it. Don't forget to get &lt;code&gt;.loop(true)&lt;/code&gt;
thus the sound will loop forever.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var sound   = webaudio.createSound().load('sounds/perfume.mp3', function(sound){
    sound.loop(true).play();
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Initialize the 3D World&lt;/h2&gt;

&lt;p&gt;First we initialize the world in 3D.
With &lt;code&gt;tQuery.createWorld()&lt;/code&gt;, we create a &lt;code&gt;tQuery.World&lt;/code&gt;.
With &lt;code&gt;.boilerplate()&lt;/code&gt;, we setup a boilerplate on this world. A boilerplate is
a fast way to get you started on the right foot. It is the
&lt;a href=&quot;http://learningthreejs.com/blog/2011/12/20/boilerplate-for-three-js/&quot;&gt;learningthreejs boilerplate for three.js&lt;/a&gt;
With &lt;code&gt;.start()&lt;/code&gt;, we start the rendering loop. So from now on, the world scene
gonna be rendered periodically, typically 60time per seconds.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var world   = tQuery.createWorld().boilerplate().start();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;We Change the background color. This confusing line ensure the background of the
3D scene will be rendered as &lt;code&gt;0x000000&lt;/code&gt; color, aka black.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.renderer().setClearColorHex( 0x000000, world.renderer().getClearAlpha() );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Here we setup the lights of our scene. This is a key factor for the look and feel
of your scene. We add a ambient light and 2 directional lights.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createAmbientLight().addTo(world).color(0x888888);
tQuery.createDirectionalLight().addTo(world).position(+1,+1,1).color(0x88FF88);
tQuery.createDirectionalLight().addTo(world).position(-1,-1, 1).color(0x8888FF);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Some constants&lt;/h2&gt;

&lt;p&gt;First we initialize &lt;code&gt;nBar&lt;/code&gt; to store number of bars in our 3D vuemeter.
This number MUST be odd, thus the vuemeter is symteric with the middle&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var nBar    = 41;
console.assert(nBar%2, &quot;nBar MUST be a odd number.&quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we need to compute the width of each 3D bar. The whole vuemeter is
 80 wide. So each bar is &lt;code&gt;80/nBar&lt;/code&gt; wide.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var barW    = 80/nBar;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;We create an array &lt;code&gt;bars3d&lt;/code&gt;. We will use it to store the object3D
for all bars of the  histogram.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var bars3d  = [];
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Build the 3D VueMeter&lt;/h2&gt;

&lt;p&gt;First we create the container group3D which gonna regroup all the bar3D. It is the
container of the whole 3D Vuemeter&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var group3d = tQuery.createObject3D().scale(1/20).addTo(world);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;We gonna build each bar and add it to &lt;code&gt;group3d&lt;/code&gt;.
We loop to create &lt;code&gt;nBar&lt;/code&gt; with &lt;code&gt;tQuery.createCube()&lt;/code&gt;. In fact a bar
is a rectangular box, so like a cube with different dimensions.
a bar got a width of &lt;code&gt;barW&lt;/code&gt;, an height of 10 and a depth of 5.
The material is a simple &lt;a href=&quot;http://en.wikipedia.org/wiki/Lambertian_reflection&quot;&gt;lambert&lt;/a&gt;.
Once the bar is create, we add it to &lt;code&gt;group3d&lt;/code&gt; and set it to the correct
position in space.
We push every bar3d into &lt;code&gt;bars3d&lt;/code&gt; for future reference.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;for(var i = 0; i &amp;lt; nBar; i++){
    var bar3d   = tQuery.createCube(barW, 10, 5, new THREE.MeshLambertMaterial({
        ambient : 0x888888,
        color   : 0xFFFFFF
    }));
    bar3d.addTo(group3d).position((i-nBar/2)*barW, 0, 0);
    bars3d.push(bar3d);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Update Vuemeter From Sound Analyser&lt;/h2&gt;

&lt;p&gt;Here we hook a function to tQuery rendering loop, &lt;code&gt;tQuery.Loop&lt;/code&gt;. Thus
this function gonna be executed everytime our 3D scene is rendered.
if the sound isnt yet loaded, do nothing.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.loop().hook(function(){
    if( sound.isPlayable() === false )  return;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;build the histogram of the sound based on
&lt;a href=&quot;https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#RealtimeAnalyserNode&quot;&gt;RealtimeAnalyserNode&lt;/a&gt;
&lt;code&gt;.getByteFrequencyData()&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var nBarHalf    = Math.ceil(nBar/2)
var histo   = sound.makeHistogram(nBarHalf);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;We gonna loop over each bar3D of our vuemeter. We gonna update
each of them based on the sound histogram we just computed.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;bars3d.forEach(function(bar3d, barIdx){
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;We need to determine which value in the histogram match this vuemeter bar.
As our vuemeter is symetric, the vuemeter bar on the far left got the same
histogram value as the one on the far right. This make this computation
a bit confusing.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;        var histoIdx        = barIdx &amp;lt; nBarHalf ? nBarHalf-1-barIdx : barIdx - nBarHalf;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we need to compute the height of the vuemeter bar based on histogram value.
This is simple scaling from one to the other: vuemeter height === histo height / 256&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;        var height      = histo[histoIdx] / 256;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now that we computed all that, we update the &lt;code&gt;bar3d&lt;/code&gt;. We update &lt;code&gt;.scale.y&lt;/code&gt;
to change its size and &lt;code&gt;.material.color&lt;/code&gt; to change its color. The formulas
i used &quot;worked for me&quot;. Up to you to be creative and find the one that fit
your own needs&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;        bar3d.get(0).scale.y    = height*3;
        bar3d.get(0).material.color.setHSV(0.3+height*0.7,1,1)
    });
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;So we used
&lt;a href=&quot;https://github.com/jeromeetienne/webaudio.js&quot;&gt;webaudio.js&lt;/a&gt;
to play a sound and analyses in real time.
We used this information to change 3D objects based on this
analysis.
We leveraged &lt;a href=&quot;https://github.com/jeromeetienne/tquery&quot;&gt;tQuery&lt;/a&gt;
to reach &lt;a href=&quot;http://github.com/mrdoob/three.js/&quot;&gt;three.js 3D engine&lt;/a&gt;.
Now you can imagine any visual effect based on sound analysis.
The road to winamp effects is open to you :)
We got a rather nice looking WebGL output of a 3D Vuemeter in Real Time
for only 40 lines of javascript. I love how short code
reduces developement time.&lt;/p&gt;

&lt;p&gt;That's all folks. Have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>tQuery plugin for Doom Characters</title>
    <link href="http://learningthreejs.com/blog/2012/05/04/tquery-md2character-a-plugin-for-doom-characters/"/>
    <updated>2012-05-04T10:26:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2012/05/04/tquery-md2character-a-plugin-for-doom-characters</id>
    <content type="html">&lt;p&gt;This post is about
&lt;a href=&quot;https://github.com/jeromeetienne/tquery/tree/dev/plugins/md2character&quot;&gt;tQuery.md2Character&lt;/a&gt;
plugin: a cool plugin which allow you to easily play with doom characters. You can see a live demo
&lt;a href=&quot;http://learningthreejs.com/data/2012-05-04-tquery-md2character-a-plugin-for-doom-characters/examples&quot;&gt;here&lt;/a&gt;.
I will walk you thru its example. It include a checkerboard for the ground, a fog for the depth, keyboard to
move your player and obviously plugins for the MD2 characters (doom formats).
We gonna learn how to move doom characters in webgl in only 50lines of javascript!&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/BaCEKbWXbfM&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;




&lt;!-- more --&gt;


&lt;h2&gt;Background knowledge&lt;/h2&gt;

&lt;p&gt;First what means MD2 ?
&lt;a href=&quot;http://en.wikipedia.org/wiki/MD2_(file_format)&quot;&gt;MD2&lt;/a&gt; is the file format used in the famous
&lt;a href=&quot;http://en.wikipedia.org/wiki/Quake_II&quot;&gt;Quake II&lt;/a&gt;.
Many of the monster you love to hate can be found in this format :)
You can find md2 models
  at &lt;a href=&quot;http://www.md2.sitters-electronics.nl/models.html&quot;&gt;sitters-electronics&lt;/a&gt;
  or at &lt;a href=&quot;http://planetquake.gamespy.com/View.php?view=Quake2.Detail&amp;amp;id=69&quot;&gt;planet quake&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;You can use it easily in three.js thanks to &lt;a href=&quot;https://twitter.com/#!/oosmoxiecode&quot;&gt;oosmoxiecode&lt;/a&gt;
He wrote a nice converter from
  &lt;a href=&quot;http://en.wikipedia.org/wiki/MD2_(file_format)&quot;&gt;MD2&lt;/a&gt;
  to
  &lt;a href=&quot;https://github.com/mrdoob/three.js/wiki/JSON-Model-format-3.0&quot;&gt;three.js json format&lt;/a&gt;.
  He wrote a &lt;a href=&quot;http://oos.moxiecode.com/blog/2012/01/md2-to-json-converter/&quot;&gt;post about it&lt;/a&gt;
  with plenty of usefull info on the subject.
&lt;a href=&quot;http://alteredqualia.com/&quot;&gt;alteredq&lt;/a&gt; wrote
several &lt;a href=&quot;http://alteredqualia.com/three/examples/webgl_morphtargets_md2_control.html&quot;&gt;cool&lt;/a&gt;
&lt;a href=&quot;http://alteredqualia.com/three/examples/webgl_morphtargets_md2.html&quot;&gt;demos&lt;/a&gt;
using it.&lt;/p&gt;

&lt;h2&gt;Let's Get Started&lt;/h2&gt;

&lt;p&gt;We gonna walk you thru the 50lines of javascript needed make this demo.
It is rather simple. It implies tQuery obviously, and various plugins:
One for the fog, one for the checkerboard used as ground, one to
bind the keyboard and obviously plugins for the MD2 Character itself.&lt;/p&gt;

&lt;iframe src=&quot;http://learningthreejs.com/data/2012-05-04-tquery-md2character-a-plugin-for-doom-characters/examples&quot;
    webkitallowfullscreen mozallowfullscreen allowfullscreen 
    width=&quot;100%&quot; height=&quot;420&quot; frameborder=&quot;0&quot;&gt;
&lt;/iframe&gt;


&lt;p&gt;Nice demo no ? You can try it
&lt;a href=&quot;http://learningthreejs.com/data/2012-05-04-tquery-md2character-a-plugin-for-doom-characters/examples&quot;&gt;here&lt;/a&gt;.
Let's code it!&lt;/p&gt;

&lt;h2&gt;The 3D World&lt;/h2&gt;

&lt;p&gt;First we initialize the world in 3D.
With &lt;code&gt;tQuery.createWorld()&lt;/code&gt;, we create a &lt;code&gt;tQuery.World&lt;/code&gt;.
With &lt;code&gt;.boilerplate()&lt;/code&gt;, we setup a boilerplate on this world. A boilerplate is
a fast way to get you started on the right foot. It is the
&lt;a href=&quot;http://learningthreejs.com/blog/2011/12/20/boilerplate-for-three-js/&quot;&gt;learningthreejs boilerplate for three.js&lt;/a&gt;
With &lt;code&gt;.start()&lt;/code&gt;, we start the rendering loop. So from now on, the world scene
gonna be rendered periodically, typically 60time per seconds.&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var world   = tQuery.createWorld().boilerplate().start();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Change the background color. This confusing line ensure the background of the
3D scene will be rendered as &lt;code&gt;0x000000&lt;/code&gt; color, aka black. We set a black
background to give an impression of night.&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.renderer().setClearColorHex( 0x000000, world.renderer().getClearAlpha() );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;The Lights&lt;/h2&gt;

&lt;p&gt;Here we setup the lights of our scene. This is important as it determine how
your scene looks. We add a ambient light and 2 directional lights.
The ambient light is a dark grey, to simulate the lack of light during the night.
We setup a directional light in front colored redish.... This is like a setting sun.
In the opposite direction, we put another direction light, bluish. This is like
the moon. Well this was my rational :)&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createAmbientLight().addTo(world).color(0x444444);
tQuery.createDirectionalLight().addTo(world).position(-1,1,1).color(0xFF88BB).intensity(3);
tQuery.createDirectionalLight().addTo(world).position( 1,1,-1).color(0x4444FF).intensity(2);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;The fog&lt;/h2&gt;

&lt;p&gt;We had a fog to the scene.
For that, we use &lt;code&gt;tquery.world.createfog.js&lt;/code&gt; plugins.
It allows to create the 2 types of fog from three.js
: &lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/scenes/FogExp2.js&quot;&gt;fogexp2&lt;/a&gt;
and
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/scenes/Fog.js&quot;&gt;fog&lt;/a&gt;.
&lt;code&gt;density&lt;/code&gt; is the density of the fog. 0.01 is very light, 0.9 is almost opaque.
In general, fogs are a nice visual trick. It is rather cheap to compute
and limits the depth of what you see.
It is a nice trick to hide the &quot;end of the world&quot; :)&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.addFogExp2({density : 0.1});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3&gt;The Columns&lt;/h3&gt;

&lt;h4&gt;initialize a material&lt;/h4&gt;

&lt;p&gt;We will apply it to all the columns. It is &lt;a href=&quot;http://en.wikipedia.org/wiki/Lambertian_reflectance&quot;&gt;lambert lighting&lt;/a&gt;
the &lt;code&gt;ambient&lt;/code&gt; is the color which gonna be combined with be combined with the ambient
light we initialized on top. &lt;code&gt;color&lt;/code&gt; will be combined with the
directional lights. and &lt;code&gt;map&lt;/code&gt; gives the texture to use.&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var material    = new THREE.MeshLambertMaterial({
    ambient : 0xFFFFFF,
    color   : 0xFFAAAA,
    map : THREE.ImageUtils.loadTexture('../../assets/images/water.jpg')
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h4&gt;Build 15 Columns&lt;/h4&gt;

&lt;p&gt;loop over each column&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;for(var i = 0; i &amp;lt; 15; i++ ){
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Create the cylinder. We pass some parameters to the contructor to setup
the size we see fit, and we add the material we want to apply on the
cylinder. Then we use &lt;code&gt;.addTo()&lt;/code&gt; to add our object to
our &lt;code&gt;tQuery.World&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    var column  = tQuery.createCylinder(0.2,0.2,2, material).addTo(world);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Change the position of the column. We translate the column to build
a kind of alley. Thus the character will be able to run inside it :)&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    column.translateX(i%2 ? +1 : -1).translateY(1).translateZ(15/2 + -1*i);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3&gt;The Ground&lt;/h3&gt;

&lt;p&gt;We create a large checkerboard with &lt;code&gt;tquery.checkerboard.js&lt;/code&gt; plugin.
We scale the checkerboard to 100 per 100 units in the 3D world. Thus it is
quite large and disappears into the fog. It gives the cheap impression of
an infinite checkerboard.&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createCheckerboard({
    segmentsW   : 100,  // number of segment in width
    segmentsH   : 100   // number of segment in Height
}).addTo(world).scaleBy(100);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3&gt;The Character&lt;/h3&gt;

&lt;p&gt;We use &lt;code&gt;tQuery.RatamahattaMD2Character&lt;/code&gt; plugin. Its inherits from
&lt;code&gt;tQuery.MD2Character&lt;/code&gt; plugin. All the configuration for this particular
character &lt;code&gt;ratamahatta&lt;/code&gt; is already done for you.
We attach it to tQuery world.
Additionnaly we use &lt;code&gt;.hookKeyboard()&lt;/code&gt; which bind arrow key to character moving.
This function is part of
&lt;a href=&quot;../../tquery.md2character.ratamahatta.keyboard.js&quot;&gt;keyboard plugins for ratamahatta&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var character   = new tQuery.RatamahattaMD2Character().attach(world).hookKeyboard();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Here we show an example of binding the &quot;loaded&quot; event.
It is notified once the whole characters data are loaded (texture, mesh for animations of
body and weapons). It just display the name of the available animations.&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;character.bind(&quot;loaded&quot;, function(){
    console.log(&quot;list animmation&quot;, Object.keys(character._meshBody.geometry.animations))
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;We setup the user camera controls.
It will determine how the user camera will move in the world scene.
We use &lt;code&gt;tQuery.MD2Character.CameraControls&lt;/code&gt; plugin made specially
for this case. With it, the camera will follow the MD2 character looking
at it from above.
world.setCameraControls(new tQuery.MD2Character.CameraControls(character));&lt;/p&gt;

&lt;h3&gt;Change the Skin by Keyboard&lt;/h3&gt;

&lt;p&gt;hook a function in the rendering loop. This function will be executed everytime
the scene is rendered. Within this function, we will use &lt;code&gt;tQuery.Keyboard&lt;/code&gt;
plugins to test the keyboard. if the key &lt;code&gt;s&lt;/code&gt; is pressed, then use &lt;code&gt;character.setSkin()&lt;/code&gt;
to change the skin of the character.&lt;/p&gt;

&lt;p&gt;```js&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.loop().hook(function(){
    var keyboard    = tQuery.keyboard();    // get keyboard instance
    if( keyboard.pressed(&quot;s&quot;) ){        // if the key 's' is pressed, change the skin
        character.setSkin(Math.floor(Math.random()*5));
    }
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3&gt;Conclusion&lt;/h3&gt;

&lt;p&gt;So we have seen what is possible to do with &lt;code&gt;tquery.md2character&lt;/code&gt; and 50lines of javascript.
It is a rather short code for what you got on the screen, if you ask me.
Btw all that released under MIT license.
I think i like the &lt;strong&gt;code walkthru&lt;/strong&gt; format.
I find it efficient to describe tQuery examples and fast for me to generate.
It is directly derived from &lt;a href=&quot;http://jashkenas.github.com/docco/&quot;&gt;annoted doc format&lt;/a&gt;
as you can see &lt;a href=&quot;http://learningthreejs.com/data/2012-05-04-tquery-md2character-a-plugin-for-doom-characters/examples/docs/&quot;&gt;here&lt;/a&gt;.
I will likely do more in the future.&lt;/p&gt;

&lt;p&gt;That's all folks. Have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Augmented Reality 3D Pong</title>
    <link href="http://learningthreejs.com/blog/2012/05/02/augmented-reality-3d-pong/"/>
    <updated>2012-05-02T13:38:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2012/05/02/augmented-reality-3d-pong</id>
    <content type="html">&lt;p&gt;This post presents a livecoding screencast of &lt;strong&gt;Augmented Reality 3D Pong&lt;/strong&gt;.
This is an experiment to use &lt;a href=&quot;https://github.com/jeromeetienne/augmentedgesture.js&quot;&gt;augmented gestures&lt;/a&gt;
as a way to interact with game. So i picked a game classic &lt;a href=&quot;http://en.wikipedia.org/wiki/Pong&quot;&gt;&quot;pong&quot;&lt;/a&gt;.
We gonna learn how to code a pong in augmented reality with webgl. The result code
is only
&lt;a href=&quot;https://github.com/jeromeetienne/augmentedgesture.js/blob/master/examples/augmentedpong/index.html&quot;&gt;100lines&lt;/a&gt;!!
Nice for augmented reality + webgl + a game :)&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/ZTwhHwAHc3c&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;




&lt;!-- more --&gt;


&lt;p&gt;But First... What is &lt;em&gt;augmented gestures&lt;/em&gt; ?
I made &lt;a href=&quot;https://github.com/jeromeetienne/augmentedgesture.js&quot;&gt;augmentedgesture.js&lt;/a&gt;.
This is a library which use &lt;a href=&quot;http://dev.w3.org/2011/webrtc/editor/getusermedia.html&quot;&gt;getUserMedia&lt;/a&gt;
and &lt;a href=&quot;http://www.webrtc.org/&quot;&gt;WebRTC&lt;/a&gt; to grab the webcam.
It analizes the image with &lt;a href=&quot;https://github.com/jeromeetienne/imageprocessing.js&quot;&gt;imageprocessing.js&lt;/a&gt;
and extract the location of flashy balls.
I presented it first at &lt;a href=&quot;http://www.web-5.org/&quot;&gt;Web-5 conference&lt;/a&gt; with me punching
Doom characters in augmented reality :)
&lt;a href=&quot;http://www.youtube.com/watch?v=hUYM93xaIgg&quot;&gt;'Doom: a new workout for geek?'&lt;/a&gt; on youtube
is preview of it. For the webgl, we obviously gonna use
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;
and
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/&quot;&gt;tQuery&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Controllers for the &lt;a href=&quot;http://en.wikipedia.org/wiki/Wii_Remote&quot;&gt;Wii&lt;/a&gt;
or
&lt;a href=&quot;http://us.playstation.com/ps3/playstation-move/&quot;&gt;PS3&lt;/a&gt; did good as game controllers.
&lt;a href=&quot;http://en.wikipedia.org/wiki/Kinect&quot;&gt;kinect&lt;/a&gt;
is super cool obviously.
They all requires to buy specific hardware tho... So the money is &lt;em&gt;a barrier&lt;/em&gt;.
Some even require specific installation on your computer, with code to compile.
This is &lt;em&gt;another barrier&lt;/em&gt;.
&lt;img class='left ' src='http://learningthreejs.com/data/2012-05-02-augmented-reality-3d-pong/images/Household-Latex-Gloves-HY-H001-1-small.jpg' width='' height='' alt='' title=''&gt;
&lt;img class='right ' src='http://learningthreejs.com/data/2012-05-02-augmented-reality-3d-pong/images/postit-small.jpg' width='' height='' alt='' title=''&gt;
With augmented gestures, you dont need specific devices. I like to use objects
which are cheap and readily available in our everyday life.
Thus people got easily access to the content, in a pure web vibe.
I use children toys that i paid 3euro per ball.
Another possibility is to use &lt;a href=&quot;http://en.wikipedia.org/wiki/Post-it_note&quot;&gt;post it&lt;/a&gt;.
They work well thanks to their flashy colors as you can see
in &lt;a href=&quot;http://www.youtube.com/watch?v=k8R1y0oqiic&quot;&gt;this video&lt;/a&gt;.
They are available in most offices.
Another is to use &lt;a href=&quot;http://en.wikipedia.org/wiki/Rubber_glove&quot;&gt;dish gloves&lt;/a&gt;. They are
readily available and cheap.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jeromeetienne.github.com/augmentedgesture.js/examples/augmentedpong/&quot;&gt;Try it&lt;/a&gt;!
This &lt;a href=&quot;http://www.youtube.com/watch?v=iunNd5lmAVE&quot;&gt;screencast&lt;/a&gt;
is a presentation on how to code
&lt;a href=&quot;http://jeromeetienne.github.com/augmentedgesture.js/examples/augmentedpong/&quot;&gt;augmented reality pong 3D&lt;/a&gt;.
The code is on &lt;a href=&quot;https://github.com/jeromeetienne/augmentedgesture.js/tree/master/examples/augmentedpong&quot;&gt;github&lt;/a&gt;
under &lt;a href=&quot;https://github.com/jeromeetienne/augmentedgesture.js/blob/master/MIT-LICENSE.txt&quot;&gt;MIT license&lt;/a&gt;.
The slides of the presentation are
&lt;a href=&quot;http://jeromeetienne.github.com/augmentedgesture.js/examples/augmentedpong/slides&quot;&gt;here&lt;/a&gt;.
Im not sure about the format of this video... the mix live coding + slides + screencast is usual.
Anyway publishing it in &quot;publish early, publish often&quot; mood :)&lt;/p&gt;

&lt;p&gt;Enjoy&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/iunNd5lmAVE&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;

</content>
  </entry>
  
  <entry>
    <title>Video Conference on Top of WebGL</title>
    <link href="http://learningthreejs.com/blog/2012/04/12/video-conference-on-top-of-webgl/"/>
    <updated>2012-04-12T13:20:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2012/04/12/video-conference-on-top-of-webgl</id>
    <content type="html">&lt;p&gt;This post presents
&lt;a href=&quot;http://webglmeeting.appspot.com&quot;&gt;WebGL Meeting&lt;/a&gt;,
a very simple WebGL application to do webrtc call.
It is a follow up of &lt;a href=&quot;http://learningthreejs.com/blog/2012/02/07/live-video-in-webgl/&quot;&gt;&quot;Fun with live video on webgl&quot;&lt;/a&gt;.
It was presenting how to use the WebCam using
&lt;a href=&quot;http://dev.w3.org/2011/webrtc/editor/getusermedia.html&quot;&gt;WebRTC getUserMedia()&lt;/a&gt;.
This one goes one step further and make an actual
&lt;a href=&quot;http://www.webrtc.org/&quot;&gt;WebRTC call&lt;/a&gt;
displayed in a WebGL scene.&lt;/p&gt;

&lt;p&gt;In fact, it has already been done a month ago! As you can see
&lt;a href=&quot;http://www.youtube.com/watch?v=em5RWcstfI0&amp;amp;feature=watch_response&quot;&gt;here&lt;/a&gt;
:)
The video from the first post, &lt;a href=&quot;http://www.youtube.com/watch?v=vnNihxl3taE&quot;&gt;'being on tv, watching tv'&lt;/a&gt; has been answered
by &lt;a href=&quot;https://plus.google.com/109216128632357967445/posts&quot;&gt;Ethan Hugg&lt;/a&gt; from cisco.
My very first video reponse btw! He
&lt;a href=&quot;http://www.youtube.com/watch?v=em5RWcstfI0&amp;amp;feature=watch_response&quot;&gt;shows a SIP video call&lt;/a&gt;
using an version of Chromium hacked by
&lt;a href=&quot;https://plus.google.com/102821430095362232437/posts&quot;&gt;Suhas Nandakumar&lt;/a&gt;.
Definitly cool stuff!
&lt;a href=&quot;http://webglmeeting.appspot.com&quot;&gt;WebGL Meeting&lt;/a&gt; is similar but run on unmodified browsers.
The
&lt;a href=&quot;http://youtu.be/Fjb7xBnxq9k&quot;&gt;screencast&lt;/a&gt;
below is short demo of it.&lt;/p&gt;

&lt;!-- more --&gt;




&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/Fjb7xBnxq9k&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;h2&gt;WebRTC progress&lt;/h2&gt;

&lt;p&gt;Using a modified browser is cool for make nice demo like
&lt;a href=&quot;https://plus.google.com/109216128632357967445/posts/QkFu7cxmbzi&quot;&gt;this one&lt;/a&gt;.
Nevertheless it reduces how widely the technology can spread.
It is now possible to do it using opensource and mainstream browsers.
This field advances so fast!&lt;/p&gt;

&lt;p&gt;&lt;img class='right ' src='http://learningthreejs.com/data/2012-04-12-video-conference-on-top-of-webgl/twoTVsWithWebGLTeam-small.jpg' width='320' height='240' alt='' title=''&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mozillamediagoddess.org/&quot;&gt;Mozilla team&lt;/a&gt; is
&lt;a href=&quot;http://hacks.mozilla.org/2012/04/webrtc-efforts-underway-at-mozilla/&quot;&gt;working hard&lt;/a&gt;
to make it happen as soon as possible.
It is even available on mobile with
&lt;a href=&quot;http://weblog.bocoup.com/javascript-webrtc-opera-mobile-12/&quot;&gt;Opera Mobile 12&lt;/a&gt;.
Some &lt;a href=&quot;http://www.youtube.com/watch?v=wpwjtzXgNFQ]&quot;&gt;&quot;protothon&quot;&lt;/a&gt; are happening about it.
&lt;a href=&quot;http://www.webrtc.org/&quot;&gt;WebRTC&lt;/a&gt;
is on the edge but it is definitly coming hard.
The picture on the right is Chrome WebRTC team doing thumb up on
&lt;a href=&quot;webglmeeting.appspot.com&quot;&gt;WebGLMeeting&lt;/a&gt;
at an WebRTC event for
&lt;a href=&quot;http://www.ietf.org/meeting/83/index.html&quot;&gt;IETF 83&lt;/a&gt;
:)&lt;/p&gt;

&lt;h2&gt;What about the code ?&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/jeromeetienne/webglmeeting&quot;&gt;WebGLMeeting source&lt;/a&gt;
is available on Github under MIT license.
It uses three.js to handle the WebGL.
It is the &lt;a href=&quot;http://code.google.com/p/webrtc-samples/source/browse/trunk/apprtc/&quot;&gt;AppRTC app&lt;/a&gt;
mostly unmodified, with a simple WebGL skin on top.&lt;/p&gt;

&lt;p&gt;A post from Chrome WebRTC team recently announced
&lt;a href=&quot;http://www.webrtc.org/blog/sourcecodetoapprtcappspotcomexampleappavailable&quot;&gt;&quot;Source code to apprtc.appspot.com example app available&quot;&lt;/a&gt;.
The post releases the
&lt;a href=&quot;http://code.google.com/p/webrtc-samples/source/browse/trunk/apprtc/&quot;&gt;source&lt;/a&gt;
on google code.
The &lt;a href=&quot;https://apprtc.appspot.com&quot;&gt;apprtc demo&lt;/a&gt;
is a very simple, one-to-one, webrtc call.
Go look at the &lt;a href=&quot;http://code.google.com/p/webrtc-samples/source/browse/trunk/apprtc/&quot;&gt;source&lt;/a&gt;, dont be shy :)
It is very small, the whole code client+server, is less than 15kbyte.
It is easy to understand and deploy thanks too google App Engine.&lt;/p&gt;

&lt;h2&gt;Face tracker seeking love ?&lt;/h2&gt;

&lt;p&gt;Surprising hey ? Well the source contains a face tracker,
&lt;a href=&quot;http://code.google.com/p/webrtc-samples/source/browse/trunk/apprtc/html/face.html&quot;&gt;face.html&lt;/a&gt;.
It works rather well but it is slow. If somebody could give it more love...
It is a rather naive implementation which works well but got many rooms for speed improvement.
It could make face tracking, less clumsy than wearing augmented reality marker on top
of your head like
&lt;a href=&quot;http://learningthreejs.com/blog/2012/03/12/augmented-reality-in-the-browser/&quot;&gt;i did a while back&lt;/a&gt;
:)&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;I got the feeling WebRTC gonna change a lot of things soon. The peer-to-peer aspect makes it super
cheap to integrate live video conferences to your own sites.&lt;/p&gt;

&lt;p&gt;That's all folks, have fun!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>tQuery WebAudio for More Realistic 3D</title>
    <link href="http://learningthreejs.com/blog/2012/03/20/sounds-for-more-realistic-3d/"/>
    <updated>2012-03-20T01:08:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/03/20/sounds-for-more-realistic-3d</id>
    <content type="html">&lt;p&gt;This post is about
&lt;a href=&quot;https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html&quot;&gt;Web Audio API&lt;/a&gt;.
It is a new HTML5 api which provide great controls on the audio layer.
It is much better than the
&lt;a href=&quot;http://www.w3.org/TR/html5/the-iframe-element.html#the-audio-element&quot;&gt;audio tag&lt;/a&gt;.
It is more suitable for games or music software.
As 3D lovers, the one feature that we care about is
&lt;a href=&quot;http://en.wikipedia.org/wiki/3D_audio_effect&quot;&gt;audio spacialization&lt;/a&gt;.
This makes Web Audio a complement to webgl.
It implements positional sounds, so you
get
&lt;a href=&quot;http://en.wikipedia.org/wiki/Panning_(audio)&quot;&gt;panning&lt;/a&gt;,
&lt;a href=&quot;http://en.wikipedia.org/wiki/Doppler_effect&quot;&gt;dopler&lt;/a&gt;
and all.
It makes the scene so much more realistic.&lt;/p&gt;

&lt;p&gt;The user tends to associate 3D to reality, so efficient 3D is a lot about realism.
The brain identifies 2D as artificial while 3D seems immediatly more natural.
Anything which appears close to reality increase this effect.
Feeding this illusion creates a more immersive experience to the user.
Realistic physics is one (stay tuned :).
Web Audio audio spacialization is another.&lt;/p&gt;

&lt;p&gt;The
&lt;a href=&quot;http://youtu.be/QjRF0_KENQ8&quot;&gt;screencast&lt;/a&gt;
below is a live coding session using &lt;code&gt;tQuery.WebAudio&lt;/code&gt;.
If you want, you can experiment with this code in our playground. Just click
&lt;a href=&quot;http://bit.ly/GApgWg&quot;&gt;here&lt;/a&gt;
and start coding :)&lt;/p&gt;

&lt;!-- more --&gt;




&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/QjRF0_KENQ8&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;h2&gt;Background on WebAudio API&lt;/h2&gt;

&lt;p&gt;To learn about WebAudio API is a large subject.
It is out of the scope of this introduction.
You can refere to many dedicated tutorials tho.
The &lt;a href=&quot;https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html&quot;&gt;specification&lt;/a&gt;
itself is clear and very readable.&lt;/p&gt;

&lt;p&gt;You can find more comprehensive documentation at &lt;a href=&quot;html://html5rocks.com&quot;&gt;html5rocks&lt;/a&gt;.
It contains several very usefull tutorials to learn Web Audio API.
They go from
&lt;a href=&quot;http://www.html5rocks.com/en/tutorials/webaudio/intro/&quot;&gt;&quot;Getting started with the web audio API&quot;&lt;/a&gt;
to
&lt;a href=&quot;http://www.html5rocks.com/en/tutorials/webaudio/positional_audio/&quot;&gt;&quot;mixing positional audio and webgl&quot;&lt;/a&gt;
or
&lt;a href=&quot;http://www.html5rocks.com/en/tutorials/webaudio/games/&quot;&gt;&quot;developing game audio&quot;&lt;/a&gt;.
If you want, you can find demos in
&lt;a href=&quot;http://chromium.googlecode.com/svn/trunk/samples/audio/index.html&quot;&gt;chromium samples&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Now let's start coding :)&lt;/p&gt;

&lt;h2&gt;Let's get Started&lt;/h2&gt;

&lt;p&gt;First you need to enable WebAudio into your world.
Thus you will be able to play sound in it.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;world.enableWebAudio();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now that the world is able to do sound, let's create one&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var sound = tQuery.createSound();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now we need to load a sound file and to start playing it. The callback
is notified when the file is downloaded. At this point, the sound
it ready to play.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sound.load('techno.mp3', function(sound){
    sound.play();
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;If you want to know more, the full API is documented
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/docs/symbols/tQuery.WebAudio.Sound.html&quot;&gt;here&lt;/a&gt;
and
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/docs/symbols/tQuery.WebAudio.html&quot;&gt;here&lt;/a&gt;
thanks to jsdoc.&lt;/p&gt;

&lt;h2&gt;Spacialization and Animation&lt;/h2&gt;

&lt;p&gt;Now that we can play a sound, what else can we do ? One definitively interesting part for
&lt;a href=&quot;https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html&quot;&gt;webaudio API&lt;/a&gt;
is the ability to spacialize the sound.
The easiest way to do that is to use &lt;code&gt;.follow()&lt;/code&gt; function.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sound.follow(object3d);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;If you want more controls, you can check
&lt;code&gt;.updateWithObject3d()&lt;/code&gt; or &lt;code&gt;.updateWithMatrix4()&lt;/code&gt;.
You may want to animate your 3D object based on the sound you hear.
For that, a simple function &lt;code&gt;.amplitude()&lt;/code&gt; has been written.
It is likely a naive implementation but it does the trick, i think.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var amplitude = sound.amplitude();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;It returns an average of low frequencies of the sound.
Note that i dunno if it is the proper term in audio world.
Most likely not :) If you know the proper term, please leave a comment.&lt;/p&gt;

&lt;h2&gt;Want more info ?&lt;/h2&gt;

&lt;p&gt;You get two examples in
&lt;a href=&quot;https://github.com/jeromeetienne/tquery/tree/master/plugins/webaudio/examples&quot;&gt;the source&lt;/a&gt;.
The
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/plugins/webaudio/examples/&quot;&gt;minimal one&lt;/a&gt;
simply play a sound.
The other is more interactive. It is the
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/plugins/webaudio/examples/playground&quot;&gt;playground&lt;/a&gt;.
It allows to play with various parameters.
tQuery API documentation is provided via
&lt;a href=&quot;http://code.google.com/p/jsdoc-toolkit/&quot;&gt;jsdoc&lt;/a&gt;.
You can find the whole API
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/&quot;&gt;here&lt;/a&gt;.
The plan is to do the same for the plugins.&lt;/p&gt;

&lt;p&gt;So for tQuery WebAudio plugin, you get API documentation of each class: the main class
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/docs/symbols/tQuery.WebAudio.html&quot;&gt;tQuery.WebAudio&lt;/a&gt;
and the
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/docs/symbols/tQuery.WebAudio.Sound.html&quot;&gt;Sound class&lt;/a&gt;.
You can even check the
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/docs/symbols/tQuery.WebAudio.NodeChainBuilder.html&quot;&gt;Node chain builder&lt;/a&gt;
doc if you want to go deep and configure your own audio nodes chain :)&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Ok so now you can play sounds in your 3D scene. You can make the sound follows a given
object3d with realistic sound spatialization. All that in just a few lines. Rather cool
if you ask me :)
&lt;a href=&quot;http://en.wikipedia.org/wiki/Winamp&quot;&gt;Winamp&lt;/a&gt; effects are back !!
Later i will likely implement
click detection as seen
&lt;a href=&quot;http://www.html5rocks.com/en/tutorials/webaudio/games/#toc-clip-detect&quot;&gt;here&lt;/a&gt;
and environmental effect like 'cathedral', 'telephone' etc...
as seen
&lt;a href=&quot;http://www.html5rocks.com/en/tutorials/webaudio/positional_audio/#toc-enveffects&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I love how sound make our 3D scene more realistic. That's all for today, have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Augmented Reality in the Browser</title>
    <link href="http://learningthreejs.com/blog/2012/03/12/augmented-reality-in-the-browser/"/>
    <updated>2012-03-12T11:36:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/03/12/augmented-reality-in-the-browser</id>
    <content type="html">&lt;p&gt;This post is about augmented reality in the browser.
In a recent post, we saw that it is now possible to
&lt;a href=&quot;http://learningthreejs.com/blog/2012/02/07/live-video-in-webgl/&quot;&gt;have live video in webgl&lt;/a&gt;
with
&lt;a href=&quot;http://www.webrtc.org/&quot;&gt;WebRTC&lt;/a&gt;.
Due to this,
&lt;a href=&quot;http://en.wikipedia.org/wiki/Augmented_reality&quot;&gt;augmented reality&lt;/a&gt;
is under the spotlight. Recently
&lt;a href=&quot;http://www.html5rocks.com/&quot;&gt;html5rock&lt;/a&gt; published a
tutorial
by
&lt;a href=&quot;http://www.html5rocks.com/en/profiles/#ilmari&quot;&gt;ilmari heikkinen&lt;/a&gt;
about
&quot;&lt;a href=&quot;http://www.html5rocks.com/en/tutorials/webgl/jsartoolkit_webrtc/&quot;&gt;writting augmented reality application using jsartoolkit&lt;/a&gt;&quot;.
Ilmari is
&lt;a href=&quot;https://plus.google.com/115293744081058969329/about&quot;&gt;google devrel for webgl&lt;/a&gt;
and the author of
&lt;a href=&quot;http://github.com/kig/JSARToolKit&quot;&gt;JSARToolKit&lt;/a&gt;
too. So we are in good hands :)
The tutorial even include a part about binding it with
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;.
I took this nice tutorial and packaged the code even easier to reuse.&lt;/p&gt;

&lt;!-- more --&gt;




&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/rzLuJxTraos&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;p&gt;&lt;img class='right ' src='http://learningthreejs.com/data/2012-03-12-augmented-reality-in-the-browser/images/marker-small.png' width='' height='' alt='' title=''&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jeromeetienne.github.com/tquery.jsartoolkit/&quot;&gt;Try this demo&lt;/a&gt;.
If you got &lt;a href=&quot;http://www.webrtc.org/running-the-demos&quot;&gt;WebRTC is available&lt;/a&gt; in your browser, take
&lt;a href=&quot;http://jeromeetienne.github.com/tquery.jsartoolkit/marker/marker.png&quot;&gt;this marker&lt;/a&gt;,
and put it in front on your webcam.
It is the same you see on the right.
It is best to print it on paper.
If you can't, point your phone to
&lt;a href=&quot;http://jeromeetienne.github.com/tquery.jsartoolkit/marker&quot;&gt;this page&lt;/a&gt; instead.
Phone screens tend to reflect lights from your environment tho. They may
reduce the accuracy of the marker detection.&lt;/p&gt;

&lt;p&gt;Now let's see how you can to use all this to build your own demos :)&lt;/p&gt;

&lt;h2&gt;You Include it&lt;/h2&gt;

&lt;p&gt;First you include it as usual in your page. The code is available
&lt;a href=&quot;https://github.com/jeromeetienne/tquery.jsartoolkit&quot;&gt;here&lt;/a&gt;.
Note that
&lt;a href=&quot;http://github.com/kig/JSARToolKit&quot;&gt;JSARToolKit&lt;/a&gt;
is released under GPL, so some restrictions apply.
The threex is under MIT license as usual.&lt;/p&gt;

&lt;p&gt;```html&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;script src=&quot;JSARToolKit.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script src=&quot;threex.jsartoolkit.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;You Initialize It&lt;/h2&gt;

&lt;p&gt;Once you get the code, you instanciate the object like this.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var threexAR    = new THREEx.JSARToolKit({
    srcElement  : srcElement,
    threshold   : threshold,
    callback    : function(event){}
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;srcElement&lt;/code&gt; may be a
&lt;a href=&quot;http://en.wikipedia.org/wiki/HTML5_video&quot;&gt;video&lt;/a&gt;, an
&lt;a href=&quot;http://www.w3.org/TR/html401/struct/objects.html#h-13.2&quot;&gt;image&lt;/a&gt;
or a
&lt;a href=&quot;http://www.w3.org/TR/html5/the-canvas-element.html&quot;&gt;canvas&lt;/a&gt;.
When the video is shoot in a uncontrolled environement,
the marker detection may be less reliable, due to variations of lighting.
&lt;code&gt;threshold&lt;/code&gt; is a value between 0 and 255 to adapt your detection to those variations.
To detect the augmented reality markers in the &lt;code&gt;srcElement&lt;/code&gt;, just use this line in your
rendering loop.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;threexAR.update();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;No rocket science here.&lt;/p&gt;

&lt;h2&gt;You Use It&lt;/h2&gt;

&lt;p&gt;During &lt;code&gt;.update()&lt;/code&gt;, the callback is notified with events.
They describe the markers present on the srcElement.
Each event got various fields:
A &lt;code&gt;.markerId&lt;/code&gt; which tell you which marker has been recognized.
The
&lt;a href=&quot;http://jeromeetienne.github.com/tquery.jsartoolkit/marker&quot;&gt;one used above&lt;/a&gt;
is the &lt;em&gt;64&lt;/em&gt;. You can find the whole list
&lt;a href=&quot;https://github.com/kig/JSARToolKit/tree/master/demos/markers&quot;&gt;in JSARToolKit repository&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;.type&lt;/code&gt; field describe what is happening to this marker.
It may be &lt;em&gt;create&lt;/em&gt;, &lt;em&gt;update&lt;/em&gt; or &lt;em&gt;delete&lt;/em&gt;.
&lt;em&gt;create&lt;/em&gt; if the marker has just been detected,
&lt;em&gt;update&lt;/em&gt; if the marker was present before.
and &lt;em&gt;delete&lt;/em&gt; if the marker is no more present.
Rather obvious :)
The &lt;code&gt;.matrix&lt;/code&gt; field is a
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/core/Matrix4.js&quot;&gt;THREE.Matrix4&lt;/a&gt;.
It is a transform which matches the position of the marker in space.&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;So now we can do augmented reality in a browser.
The code of the demo is &lt;a href=&quot;https://github.com/jeromeetienne/tquery.jsartoolkit&quot;&gt;here&lt;/a&gt;.
Up to us to find actual application of this technology.
Currently most browsers with webcam are running on desktop/laptop tho.
As most their webcam is directly attached to screens, It limits the flexibility of
what you could put on front of the camera.
As for mobile, only opera 12 is currently the only mobile browser able
to read the webcam.&lt;/p&gt;

&lt;p&gt;That's all folks. Have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>tQuery v0 - Let's get started</title>
    <link href="http://learningthreejs.com/blog/2012/03/05/tquery-version-0/"/>
    <updated>2012-03-05T10:42:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/03/05/tquery-version-0</id>
    <content type="html">&lt;p&gt;This post is an update on
&lt;a href=&quot;https://github.com/jeromeetienne/tquery&quot;&gt;tquery&lt;/a&gt; progress.
&lt;a href=&quot;http://learningthreejs.com/blog/categories/tquery/&quot;&gt;Our previous posts&lt;/a&gt;
were previews,
for example
&lt;a href=&quot;http://learningthreejs.com/blog/2012/02/15/valentine-card-in-tquery/&quot;&gt;valentine card in tQuery&lt;/a&gt;
or
&lt;a href=&quot;http://learningthreejs.com/blog/2012/02/27/linkify-tquery-extension/&quot;&gt;linkify, a tQuery extension&lt;/a&gt;.
This post is the release of &lt;em&gt;version 0&lt;/em&gt;.
It will walk you thru the website and shows how to run your first tQuery project
with the boilerplate.
You should be able to play with tQuery after that :)&lt;/p&gt;

&lt;p&gt;Ok It is still experimental.
I have been paddling hard to make it usable by other people tho.
The &lt;a href=&quot;http://jeromeetienne.github.com/tquery/www/playground/&quot;&gt;playground&lt;/a&gt;
is the easiest way to start experimenting. It is all online.
no install, no download, simple and understandable.
tQuery code is all on &lt;a href=&quot;https://github.com/jeromeetienne/tquery&quot;&gt;github repository&lt;/a&gt;.
The
&lt;a href=&quot;http://www.youtube.com/watch?feature=player_embedded&amp;amp;v=iby6kijX5Zw&quot;&gt;screencast&lt;/a&gt;
below will walk you thru the
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/www/&quot;&gt;website&lt;/a&gt;.&lt;/p&gt;

&lt;!-- more --&gt;




&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/iby6kijX5Zw&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;h2&gt;Solid Ground to Build On&lt;/h2&gt;

&lt;p&gt;I would like tQuery to be a solid ground. Thus people can easily build
their three.js extensions on top of it. So the code is
documented, tested and performance is monitored. Here is some principles that
i consider important for tQuery.
Note that those principles are the theory.
It doesnt imply i implement them well in practice :)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code must be tested&lt;/strong&gt;. It helps detect bugs earlier.
Our &lt;a href=&quot;http://jeromeetienne.github.com/tquery/tests/&quot;&gt;tests&lt;/a&gt;
are done with
&lt;a href=&quot;http://visionmedia.github.com/mocha/&quot;&gt;mocha&lt;/a&gt;.
&lt;strong&gt;API must be documented&lt;/strong&gt;. It helps new users to use the library.
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/docs/&quot;&gt;API documentation&lt;/a&gt;
is done with
&lt;a href=&quot;http://code.google.com/p/jsdoc-toolkit/&quot;&gt;jsdoc&lt;/a&gt;.
&lt;strong&gt;Performance must be monitored&lt;/strong&gt;. Thus developpers are immediatly aware of performance
change when the code is modified.
Our
&lt;a href=&quot;http://jeromeetienne.github.com/tquery/bench/&quot;&gt;benchmarks&lt;/a&gt;
are done with
&lt;a href=&quot;http://benchmarkjs.com/&quot;&gt;benchmark.js&lt;/a&gt;
and displayed by
&lt;a href=&quot;https://github.com/jeromeetienne/benchrunner&quot;&gt;benchrunner&lt;/a&gt;.&lt;/p&gt;

&lt;h2&gt;How to Get Started&lt;/h2&gt;

&lt;p&gt;or how to get the boilerplate :)
tQuery Boilerplate is a template to get you started. You download it and
modify it until it fits your needs. It is a fast way to start a
clean project with tquery.
The running boilerplate looks &lt;a href=&quot;http://jeromeetienne.github.com/tqueryboilerplate/&quot;&gt;like that&lt;/a&gt;.
The
&lt;a href=&quot;http://www.youtube.com/watch?feature=player_embedded&amp;amp;v=YOsnKMesyRk&quot;&gt;screencast&lt;/a&gt;
below shows how to use it.&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/YOsnKMesyRk&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;h2&gt;Running tQuery Boilerplate&lt;/h2&gt;

&lt;p&gt;You can try the boilerplate online with the &lt;a href=&quot;http://jeromeetienne.github.com/tquery/www/playground/&quot;&gt;playground&lt;/a&gt;.
Want to run it on your computer ?
First you get boilerplate's files
&lt;a href=&quot;https://github.com/downloads/jeromeetienne/tquery/tqueryboilerplate.zip&quot;&gt;here&lt;/a&gt;.
Then you launch the http server to serve them. Here is a little shell script which does it all for you.&lt;/p&gt;

&lt;p&gt;```bash&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;curl -OL https://github.com/downloads/jeromeetienne/tquery/tqueryboilerplate.zip
unzip tqueryboilerplate.zip
cd tqueryboilerplate
make server
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Then you open a browser on &lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;http://127.0.0.1:8000/&lt;/a&gt; to
see it running. Up to you to modify &lt;code&gt;index.html&lt;/code&gt; until it fits your needs. &lt;code&gt;index.html&lt;/code&gt;
looks like the code below... Quite short.&lt;/p&gt;

&lt;p&gt;```html&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;!doctype html&amp;gt;&amp;lt;title&amp;gt;Minimal tQuery Page&amp;lt;/title&amp;gt;
&amp;lt;script src=&quot;./tquery-all.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;body&amp;gt;&amp;lt;script&amp;gt;
    var world   = tQuery.createWorld().boilerplate().start();
    var object  = tQuery.createTorus().addTo(world);
&amp;lt;/script&amp;gt;&amp;lt;/body&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;This is the initial release of tQuery.
I like how it looks.
API is documented,
code is tested, and performance measured.
The code produced by the API seems short and quite understandable.
Nice foundations especially for a version 0.&lt;/p&gt;

&lt;p&gt;The next step is about stabilizing tquery.js itself, cleaning it up.
I am currently quite busy doing just that.
So please dont hammer me with feature requests at the moment, i won't have
time to handle them.
Pull requests are welcomed tho.
Things will change when tQuery core become more stable.&lt;/p&gt;

&lt;p&gt;That's all folks, have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Linkify, a tQuery Extension</title>
    <link href="http://learningthreejs.com/blog/2012/02/27/linkify-tquery-extension/"/>
    <updated>2012-02-27T08:55:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/02/27/linkify-tquery-extension</id>
    <content type="html">&lt;p&gt;This post is an update on
&lt;a href=&quot;https://github.com/jeromeetienne/tquery&quot;&gt;tquery&lt;/a&gt; progress.
It is about &lt;code&gt;linkify&lt;/code&gt;, a first experimental extension.
Thanks to it, any 3D object may become a link.
So  3D objects act as a &lt;code&gt;&amp;lt;a&amp;gt;&lt;/code&gt; tag, i.e. the object becomes
clickable and clicking on it open a new url.
It is built on top of domEvents.
It is used to incoporate
&lt;a href=&quot;http://www.w3.org/TR/DOM-Level-2-Events/events.html&quot;&gt;dom kindof events&lt;/a&gt;
in 3D world.
We saw them a few week back in
&lt;a href=&quot;http://learningthreejs.com/blog/2012/01/17/dom-events-in-3d-space/&quot;&gt;'dom events in 3D space' post&lt;/a&gt;.
Previous posts on tquery may be found &lt;a href=&quot;http://learningthreejs.com/blog/categories/tquery/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;!-- more --&gt;




&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/MlW7PeuXGDM&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;p&gt;Building extensions on top of others is kinda the point of an extension system.
My dream scenario is :
(1) People do plugins for three.js, like they do in jQuery).
(2) They share their work.
(3) They build on top of each other.
(4) Loop to 1.
All in opensource spirit. All good in my book. Ok enougth talk, let's code.&lt;/p&gt;

&lt;h2&gt;Dom Events in 3D Space&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;domEvents&lt;/em&gt; have been ported to tQuery.
It is an important part because jQuery developpers use this a lot, thru
&lt;a href=&quot;http://api.jquery.com/on/&quot;&gt;.on()&lt;/a&gt;/&lt;a href=&quot;http://api.jquery.com/off/&quot;&gt;.off()&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery('cube').on('mouseover', function(event){
    console.log(&quot;somebody put the mouse over a cube&quot;);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;The supported events are click obviously,
&lt;a href=&quot;http://www.quirksmode.org/dom/events/click.html&quot;&gt;dblclick, mouseup, mousedown&lt;/a&gt;
, &lt;a href=&quot;http://www.quirksmode.org/dom/events/mouseover.html&quot;&gt;mouseover and mouseout&lt;/a&gt;.
It has been improved to better match
&lt;a href=&quot;http://www.w3.org/TR/DOM-Level-2-Events/events.html&quot;&gt;actual dom events&lt;/a&gt;.
The callback now receives a event object. It contains &lt;code&gt;.type&lt;/code&gt; and &lt;code&gt;.target&lt;/code&gt;
as described in &lt;a href=&quot;http://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-Event&quot;&gt;dom specification&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery('.myClass').on('click', function(event){
    console.log(&quot;An event of type&quot;, event.type, &quot;has been trigger on &quot;, event.target);
    // If you wish to stop propagation, just do 
    event.stopPropagation();
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-flow-bubbling&quot;&gt;Event bubbling&lt;/a&gt;
is now supported. So events are dispatched to the
&lt;a href=&quot;http://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-EventTarget&quot;&gt;target&lt;/a&gt;
and follow its parent chain upward. It is possible to cancel propagation with an usual
&lt;code&gt;.stopPropagation()&lt;/code&gt;.&lt;/p&gt;

&lt;h2&gt;Linkify or How Any 3D Object May Become a Link&lt;/h2&gt;

&lt;p&gt;Linkify is an experimental plugins built on top of &lt;code&gt;tquery.domevent&lt;/code&gt;. It is
shown in the screencast.
It makes any 3D objects object act as a &lt;code&gt;&amp;lt;a&amp;gt;&lt;/code&gt; tag, i.e. the object becomes
clickable and clicking on it open a new url. When the mouse is over it, an underline
is added to make it even more webpage like.
Code is rather short.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery('text').linkify('http://example.com')
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;It has been quite time consuming to set up the basis for the project:
tests, bechmarks, docs, or plugins interdependancy resolution.
For each of those field, i had to review the various alternatives,
pick one and setting it up as properly as possible.&lt;/p&gt;

&lt;p&gt;Here are the current choises, they may change in the future.
&lt;a href=&quot;http://requirejs.org/&quot;&gt;require.js&lt;/a&gt; will be used for the dependancies between plugins.
Tests are done with &lt;a href=&quot;http://visionmedia.github.com/mocha/&quot;&gt;mocha&lt;/a&gt;,
a javascript test framework for javascript which run in node.js and browser.
Later, we may improve that by testing the rendering output using
&lt;a href=&quot;http://www.pixastic.com/&quot;&gt;pixastic&lt;/a&gt; to do
&lt;a href=&quot;http://en.wikipedia.org/wiki/Mean_squared_error&quot;&gt;statistical&lt;/a&gt;
&lt;a href=&quot;http://en.wikipedia.org/wiki/Peak_signal-to-noise_ratio&quot;&gt;images&lt;/a&gt;
&lt;a href=&quot;http://en.wikipedia.org/wiki/Root_mean_square_deviation&quot;&gt;comparison&lt;/a&gt;.
Benchmarks are done with
&lt;a href=&quot;http://benchmarkjs.com/&quot;&gt;benchmarks.js&lt;/a&gt;, a robust benchmarking library for javascript,
using
&lt;a href=&quot;https://github.com/jeromeetienne/benchrunner&quot;&gt;benchrunner&lt;/a&gt;
as runner.
It is the engine behind the wellknown
&lt;a href=&quot;http://jsperf.com/browse&quot;&gt;jsperf&lt;/a&gt;
site.
Inline documentation is written in &lt;a href=&quot;http://code.google.com/p/jsdoc-toolkit/&quot;&gt;jsdoc&lt;/a&gt;
format using
&lt;a href=&quot;http://www.thebrightlines.com/2010/05/06/new-template-for-jsdoctoolkit-codeview/&quot;&gt;codeview&lt;/a&gt;
template.&lt;/p&gt;

&lt;p&gt;That's all folks. Have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>a Valentine card in tQuery</title>
    <link href="http://learningthreejs.com/blog/2012/02/15/valentine-card-in-tquery/"/>
    <updated>2012-02-15T10:21:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/02/15/valentine-card-in-tquery</id>
    <content type="html">&lt;p&gt;The &lt;a href=&quot;http://learningthreejs.com/blog/categories/tquery/&quot;&gt;tQuery&lt;/a&gt; experimentation is going on.
It is a lot of fun to code :)
This post is just a short presentation of two plugins currently in incubation:
tquery.text and tquery.shape.
Yesterday was
&lt;a href=&quot;http://en.wikipedia.org/wiki/Valentine's_Day&quot;&gt;valentine day&lt;/a&gt;,
so i thought it would be cool to stay in topic.
The
&lt;a href=&quot;http://www.youtube.com/watch?v=8EHqrAXcKrY&quot;&gt;screencast&lt;/a&gt;
is a live coding of a
&lt;a href=&quot;http://learningthreejs.com/data/2012-02-15-valentine-card-in-tquery/&quot;&gt;valentine card&lt;/a&gt; in tQuery :)&lt;/p&gt;

&lt;!-- more --&gt;




&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/8EHqrAXcKrY&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;h2&gt;Let's Write Text in 3D&lt;/h2&gt;

&lt;p&gt;tQuery.text plugin writes text in 3D.
It is based on
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/extras/geometries/TextGeometry.js&quot;&gt;TextGeometry&lt;/a&gt;.
Here is a simple example.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createText(&quot;tQuery is Fun!&quot;).addTo(world);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Let's Easily Create Shape&lt;/h2&gt;

&lt;p&gt;&lt;img class='right  ' src='http://learningthreejs.com/data/2012-02-15-valentine-card-in-tquery/images/shape.triangle-small.png' width='' height='' alt='' title=''&gt;&lt;/p&gt;

&lt;p&gt;tQuery shape is made to easily build and
&lt;a href=&quot;http://en.wikipedia.org/wiki/Extrusion&quot;&gt;extrude&lt;/a&gt;
shapes in javascript.
It is based on
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/extras/core/Shape.js&quot;&gt;THREE.Shape&lt;/a&gt;.
tquery.shape is cool because it uses a API very similar to
&lt;a href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#complex-shapes-(paths)&quot;&gt;canvas 2D&lt;/a&gt;
&lt;a href=&quot;https://developer.mozilla.org/en/Canvas_tutorial/Drawing_shapes&quot;&gt;path&lt;/a&gt;.
This line will build a triangle.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery.createShape().moveTo(0,0).lineTo(1,1).lineTo(-1,1).lineTo(0,0);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;&lt;img class='left  ' src='http://learningthreejs.com/data/2012-02-15-valentine-card-in-tquery/images/shape.fish-small.png' width='' height='' alt='' title=''&gt;
&lt;img class='right ' src='http://learningthreejs.com/data/2012-02-15-valentine-card-in-tquery/images/shape.smiley-small.png' width='' height='' alt='' title=''&gt;&lt;/p&gt;

&lt;p&gt;Some shapes are already available, like the triangle above, or a fish, smiley
and a heart. Here is a smiley.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var shape = tQuery.createSmileyShape();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;The valentince card&lt;/h2&gt;

&lt;p&gt;Last but not least, the valentine card!
&lt;a href=&quot;http://learningthreejs.com/data/2012-02-15-valentine-card-in-tquery/&quot;&gt;Try it out&lt;/a&gt;!
It uses the plugins above to build an animated valentine card.
It is done with less than 20lines...
tQuery seems to produce short code.&lt;/p&gt;

&lt;iframe src=&quot;http://learningthreejs.com/data/2012-02-15-valentine-card-in-tquery/&quot;
    webkitallowfullscreen mozallowfullscreen allowfullscreen 
    width=&quot;100%&quot; height=&quot;349&quot; frameborder=&quot;0&quot;&gt;
&lt;/iframe&gt;


&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Today we saw 2 plugins still in progress.
tQuery experiment seems to go well for now.
The code is moving at fast pace.
I am currently experimenting with &lt;a href=&quot;http://requirejs.org/&quot;&gt;require.js&lt;/a&gt;
to automatically resolve dependancies between plugins.
What's next ? likely a series with a step by step on how to build a tunnel game.&lt;/p&gt;

&lt;p&gt;That's all folks! have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>An Extension System for three.js</title>
    <link href="http://learningthreejs.com/blog/2012/02/08/extension-system-for-three-js/"/>
    <updated>2012-02-08T15:24:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/02/08/extension-system-for-three-js</id>
    <content type="html">&lt;p&gt;  This post an overview of a work-in-progress.
It is about an extension system on top of three.js which mimics jQuery API.
I came up with the idea while thinking about how to
trim three.js and make it easier to maintain. I have always been impressed
with jQuery plugin ecosystem. It is lively, varied,
and contains impressive specimens. I would love to have such
a rich ecosystem for three.js's plugins.&lt;/p&gt;

&lt;p&gt;  Let's call this experiment &lt;strong&gt;tQuery&lt;/strong&gt; as in &quot;three.js + jQuery&quot;.
It makes it easier to understand if you already known this library.
This is a v0 in the
&lt;a href=&quot;http://catb.org/~esr/writings/homesteading/cathedral-bazaar/ar01s04.html&quot;&gt;&quot;publish early, publish often&quot;&lt;/a&gt;
vibe.
The goal of this little project is to see if we can mix
to mix three.js power with jquery API usability...
How far this concept can fly ? We will see.&lt;/p&gt;

&lt;p&gt;So what do we want ? The code must make &lt;strong&gt;three.js easy to extend&lt;/strong&gt;
and should &lt;strong&gt;mimics jQuery whenever possible&lt;/strong&gt;.
In order to see if the system hold under load, i wrote several extensions already.
It is very early. The architecture of it all is far from stable.
Code is advancing at fast pace tho :)
The screencast below is short live coding session. Just to give an idea of the current
status.&lt;/p&gt;

&lt;!-- more --&gt;




&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/Aa7sHUE224A&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;h2&gt;DOM&lt;/h2&gt;

&lt;p&gt;With jQuery and the
&lt;a href=&quot;http://en.wikipedia.org/wiki/Document_Object_Model&quot;&gt;DOM&lt;/a&gt;, you
get a tree of
&lt;a href=&quot;https://developer.mozilla.org/en/DOM/element&quot;&gt;elements&lt;/a&gt;
from the page.
In fact, three.js got this tree as well. Surprising hey ?
We just name it a
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/scenes/Scene.js&quot;&gt;scene&lt;/a&gt;
instead of a tree.
And our element are called
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/core/Object3D.js&quot;&gt;Object3D&lt;/a&gt;.
But all that is just a matter of vocabulary.&lt;/p&gt;

&lt;p&gt;One one hand, jquery one, you got the dom and its tree of element.
on the other hand, three.js one, you got the scene and its tree of object3D.
Same Thing!&lt;/p&gt;

&lt;h2&gt;Chained API&lt;/h2&gt;

&lt;p&gt;jQuery got a chained API, so tQuery got a chained API. When we said
&lt;em&gt;copy jQuery whenever possible&lt;/em&gt;, we were not kidding :)&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery('.fooKlass').scale(2).translate(1,0,0);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;IDs and classes&lt;/h2&gt;

&lt;p&gt;They got
&lt;a href=&quot;http://api.jquery.com/id-selector/&quot;&gt;Ids&lt;/a&gt;
and
&lt;a href=&quot;http://api.jquery.com/class-selector/&quot;&gt;classes&lt;/a&gt;
, or more recently
&lt;a href=&quot;http://api.jquery.com/data/&quot;&gt;data&lt;/a&gt;.
So we did all the same with tQuery.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var cube    = tQuery().createCube();
cube.id(&quot;myId&quot;);    // set the id of this element
cube.addClass('fooKlass');  // add 'fooKlass' class to this cube
cube.data('goom', 'baa');
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Selector&lt;/h2&gt;

&lt;p&gt;jQuery got selectors so tQuery got selectors too.
Here are the selector based on geometry, they are similar to the
[element selector] in jQuery, e.g. &lt;code&gt;jQuery('span')&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery('sphere');   // select all objects with a sphere gemotry
tQuery('cube'); // smae with a cube gemotry
// and so on
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Here are the one for classes and id.
Note how the syntax is similar to css selector.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery('#myId') // to get the object with the 'myId' id
tQuery('.fooklass') // to get objects with the class 'fooklass'
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;obvious we got compose them like with jQuery&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery('.bar.foo')  // objets with the class 'bar' and 'foo'
tQuery('.bar cube') // objets with the class 'bar' with a cube as descandant
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Events&lt;/h2&gt;

&lt;p&gt;Obviously jQuery got events, so we got events in tQuery.
we use &lt;em&gt;domEvents&lt;/em&gt; we saw a few week back in
&lt;a href=&quot;http://learningthreejs.com/blog/2012/01/17/dom-events-in-3d-space/&quot;&gt;'dom events in 3D space' post&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tQuery('cube').on('mouseover', function(){
    console.log(&quot;somebody put the mouse over a cube&quot;);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;A Basic Page&lt;/h2&gt;

&lt;iframe src=&quot;http://jeromeetienne.github.com/tquery/plugins/minimal/examples&quot;
    webkitallowfullscreen mozallowfullscreen allowfullscreen 
    width=&quot;260&quot; height=&quot;280&quot; frameborder=&quot;0&quot; style=&quot;float: right; margin-left: 1em;&quot;&gt;
&lt;/iframe&gt;


&lt;p&gt;This is a minimal page. the code is below, the preview on the right.
Quite short.&lt;/p&gt;

&lt;p&gt;```html&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;!doctype html&amp;gt;&amp;lt;title&amp;gt;tQuery Basic Page&amp;lt;/title&amp;gt;
&amp;lt;script src=&quot;tquery-bundle.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;body&amp;gt;
    &amp;lt;script&amp;gt;

    var world = tQuery.createWorld().fullpage().start();
    var object = tQuery.createTorus().addTo(world);

    &amp;lt;/script&amp;gt;
&amp;lt;/body&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;This was early presentation of tQuery. I like the idea, we will see how it goes.
The purpose of this experiement is to help those who know jQuery to use three.js.
So they reuse jquery syntax but inside a webgl context.
This is a very early project.
How far is it possible to push this concept of &lt;em&gt;&quot;three.js power + jQuery API usuability&quot;&lt;/em&gt;.
It seems all very cute at first sight but only time will tell.&lt;/p&gt;

&lt;p&gt;That's all folks. More on tQuery soon. Have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Fun With Live Video in WebGL</title>
    <link href="http://learningthreejs.com/blog/2012/02/07/live-video-in-webgl/"/>
    <updated>2012-02-07T13:41:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/02/07/live-video-in-webgl</id>
    <content type="html">&lt;p&gt;This post is about live video in webgl.
It is possible in today browsers to read the webcam using a new feature from html5, called WebRTC.
This standard is
about real-time communications such video conferences.
It is an open source project supported by Google, Mozilla and Opera.
Quite neat hey!&lt;/p&gt;

&lt;p&gt;I think live video has a lot of potential usages in 3D.
It is so cool for interactivity.
The player sees himself on the screen. It becomes part of the actions.
Quite immersive effect.
We can imagine something like &lt;a href=&quot;http://secondlife.com/&quot;&gt;second life&lt;/a&gt;, where
people wander around and interact live with each other in a virtual world.
Our demo is about TV... Another obvious use may be
&lt;a href=&quot;http://en.wikipedia.org/wiki/Reflection_(physics)&quot;&gt;reflections&lt;/a&gt;
like
&lt;a href=&quot;http://en.wikipedia.org/wiki/Mirror&quot;&gt;mirror&lt;/a&gt;
or
&lt;a href=&quot;http://en.wikipedia.org/wiki/Specular_reflection&quot;&gt;water&lt;/a&gt;.
What about your face from the webcam reflecting in water with animated waves ?
Would be nice!&lt;/p&gt;

&lt;!-- more --&gt;




&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/vnNihxl3taE&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;p&gt;It is surely nice but WebRTC is still quite on the edge.
To enable webrtc on your computer, see how to
&lt;a href=&quot;http://www.webrtc.org/running-the-demos&quot;&gt;run webrtc demos&lt;/a&gt;.
It is currently available only in
&lt;a href=&quot;http://tools.google.com/dlpage/chromesxs&quot;&gt;Canari&lt;/a&gt;.
Mozilla people are working hard to make it happen as soon as possible.
So it may be too early to use it for 'serious' things.
But way enougth to do cool experiments like the one we gonna do today :)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://learningthreejs.com/data/live-video-in-webgl&quot;&gt;Try it out&lt;/a&gt;!!
The first step will be to create a video element.
We gonna start to make it play either a normal video file
then to play video from the webcam using
&lt;a href=&quot;https://dvcs.w3.org/hg/audio/raw-file/tip/streams/StreamProcessing.html&quot;&gt;mediastream API&lt;/a&gt;.
After that, we gonna map this video to a normal texture.
And we will be done !
It is that simple, now let's get started.&lt;/p&gt;

&lt;h2&gt;Let's create the video element&lt;/h2&gt;

&lt;p&gt;The
&lt;a href=&quot;http://en.wikipedia.org/wiki/HTML5_video&quot;&gt;video element&lt;/a&gt;
is the DOM way to handle video in webpage.
Let's create the video element.
Later we will use it as texture and display it in WebGL.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;video       = document.createElement('video');
video.width = 320;
video.height    = 240;
video.autoplay  = true;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;It you wish to create a video from a file webm, mp4 or ogv, just set
its &lt;code&gt;.src&lt;/code&gt; property.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;video.src = &quot;http://example.com/supercatvideo.webm&quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;It wasn't too hard, hey :) So now we know how to get a video from a file.
Let's see if we can use the webcam and get this nice immersive effect for our
users.&lt;/p&gt;

&lt;h2&gt;Let's Use the Webcam if Available&lt;/h2&gt;

&lt;p&gt;Our first step is to detect if the media stream API is available.
The following line will do the job nicely.
&lt;code&gt;hasUserMedia&lt;/code&gt; will be true if it is available, false otherwise.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var hasUserMedia = navigator.webkitGetUserMedia ? true : false;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;If it isn't, you may point the users to
&lt;a href=&quot;http://www.webrtc.org/running-the-demos&quot;&gt;this doc&lt;/a&gt;
on how to get it
and/or using a normal video file.
Now we need to check if we can read the webcam.
For that, we use the following lines.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;navigator.webkitGetUserMedia('video', function(stream){
    video.src   = webkitURL.createObjectURL(stream);
}, function(error){
    console.log(&quot;Failed to get a stream due to&quot;, error);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;A pseudo URL will be created by &lt;code&gt;.createObjectURL&lt;/code&gt;.
It would allows the video element to automagically read the webcam.
It looks a bit like that.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;blob:http%3A//learningthreejs.com/e33eb278-08a8-4052-9dca-3c7663c88bc0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Handle the textures&lt;/h2&gt;

&lt;p&gt;Now we got the &lt;a href=&quot;https://developer.mozilla.org/En/HTML/Element/Video&quot;&gt;video element&lt;/a&gt; ready.
Let's create a texture using it as source.
The last step before seeing the video moving on screen :)
Use this simple line. It is enougth.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var videoTexture = new THREE.Texture( video );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;This texture is a normal texture and can be used as usual in materials.
For example, in a &lt;a href=&quot;http://en.wikipedia.org/wiki/Lambertian_reflectance&quot;&gt;lambert&lt;/a&gt; material.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var material    = new THREE.MeshLambertMaterial({
    map : videoTexture
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;But this texture is special, it is a video. So it need to be constantly updated.
In your render loop, add those lines. They monitor the state of your video.
Every time the video got enougth data to be display, the texture is updated
and sent to the GPU.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;if( video.readyState === video.HAVE_ENOUGH_DATA ){
    videoTexture.needsUpdate = true;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Now you can display your webcam inside your webgl !!
This is simple and cool.
Browser support will increase with time.
Live video is a very powerfull tool.
The image from the webcam is a normal one.
On it, you can perform
&lt;a href=&quot;https://github.com/mrdoob/three.js/tree/master/examples/js/postprocessing&quot;&gt;post processing&lt;/a&gt;,
&lt;a href=&quot;http://en.wikipedia.org/wiki/Edge_detection&quot;&gt;edge detection&lt;/a&gt;,
and many other crazy things. Up to you to experiment.
Let's all for today folks, have fun :)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Casting Shadows</title>
    <link href="http://learningthreejs.com/blog/2012/01/20/casting-shadows/"/>
    <updated>2012-01-20T14:44:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/01/20/casting-shadows</id>
    <content type="html">&lt;p&gt;This post is about
&lt;a href=&quot;http://en.wikipedia.org/wiki/Shadow_mapping&quot;&gt;shadow casting&lt;/a&gt;,
a technique which approximates the effect you see in real life everyday.
They may be tricky to tune but they looks so good, it worths it.
Shadows are an efficient tool when you to make your scene more realistic.
We will see how they can be used inside
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;
and see more about lights while we are at it.&lt;/p&gt;

&lt;p&gt;As usual, there is a &lt;a href=&quot;http://learningthreejs.com/data/casting-shadows/&quot;&gt;demo&lt;/a&gt;.
It is kept it real simple thus you can read the code more easily.
The scene is a simple object in the middle, a spotlight moving around and a plane
to receive the object shadow. The light frustum is left visible in orange.&lt;/p&gt;

&lt;!-- more --&gt;




&lt;iframe src=&quot;http://learningthreejs.com/data/casting-shadows&quot;
    webkitallowfullscreen mozallowfullscreen allowfullscreen 
    width=&quot;100%&quot; height=&quot;420&quot; frameborder=&quot;0&quot;&gt;
&lt;/iframe&gt;


&lt;h2&gt;Let's Code Shadows&lt;/h2&gt;

&lt;p&gt;Casting shadows in
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;
involves 3 parts: the
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/renderers/WebGLRenderer.js&quot;&gt;renderer&lt;/a&gt;
which does the computation, the
&lt;a href=&quot;https://github.com/mrdoob/three.js/tree/master/src/lights&quot;&gt;lights&lt;/a&gt;
which cast shadows, and
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/core/Object3D.js&quot;&gt;objects&lt;/a&gt;
which receives lights and shadows.&lt;/p&gt;

&lt;h2&gt;Set up the Renderer&lt;/h2&gt;

&lt;p&gt;The renderer is the one which will compute the shadows positions for your 3D scene.
Shadow casting is quite expensive. It is only supported by
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/renderers/WebGLRenderer.js&quot;&gt;WebGLRenderer&lt;/a&gt;.
It uses
&lt;a href=&quot;http://en.wikipedia.org/wiki/Shadow_mapping&quot;&gt;Shadow mapping&lt;/a&gt;, a technique specific
to WebGL, performed directly on the &lt;a href=&quot;http://en.wikipedia.org/wiki/Graphics_processing_unit&quot;&gt;GPU&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;renderer.shadowMapEnabled = true;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;&lt;img class='right ' src='http://learningthreejs.com/data/casting-shadows/images/screenshot-withsoftshadow-small.png' width='' height='' alt='' title=''&gt;
&lt;img class='left ' src='http://learningthreejs.com/data/casting-shadows/images/screenshot-nosoftshadow-small.png' width='' height='' alt='' title=''&gt;&lt;/p&gt;

&lt;p&gt;You can smooth produced shadows with &lt;code&gt;shadowMapSoft&lt;/code&gt;. It default to false.
On the left, the shadow is crisp, on the right it is soft.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;// to antialias the shadow
renderer.shadowMapSoft = true;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Configure your objects&lt;/h2&gt;

&lt;p&gt;For
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/core/Object3D.js&quot;&gt;Object3D&lt;/a&gt;,
two parameters controls how they interact with lights and shadows.
Set &lt;code&gt;.castShadow&lt;/code&gt; to true if the object occludes light, so to cast a shadow.
Set &lt;code&gt;.receiveShadow&lt;/code&gt; to true if the object is supposed to receive shadows.
Both default to false&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;object3d.castShadow = true;
object3d.receiveShadow  = false;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;This is the configuration for the central object in the demo. It will occlude lights but
won't be able to receive shadow. So you wont see any
&lt;a href=&quot;http://en.wikipedia.org/wiki/Self-shadowing&quot;&gt;self shadow&lt;/a&gt;.&lt;/p&gt;

&lt;h2&gt;Tune your Lights&lt;/h2&gt;

&lt;p&gt;&lt;img class='left  ' src='http://learningthreejs.com/data/casting-shadows/images/light-directionallight-small.jpg' width='' height='' alt='' title=''&gt;
&lt;img class='right ' src='http://learningthreejs.com/data/casting-shadows/images/light-spotlight-small.jpg' width='' height='' alt='' title=''&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/lights/DirectionalLight.js&quot;&gt;THREE.DirectionalLight&lt;/a&gt;
or
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/lights/SpotLight.js&quot;&gt;THREE.SpotLight&lt;/a&gt;
are able to cast shadows.
Let's details them.
A directional light is when light rays are parallel.
A bit like when you look at the sun rays on the left.
It mostly behaves like a light source very far from us.
A spot light is when light rays seems to originate from a single point, and
spreads outward in a coned direction, like in the dance club on the right
(Images are from wikipedia).
To enable the shadow casting on a light,
just use this line.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;light.castShadow = true;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;You can tune the &lt;code&gt;shadowDarkness&lt;/code&gt;.
It is the opacity of the shadow. 0 means no shadow, 1 means pure back shadow.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;light.shadowDarkness = 0.5;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;&lt;img class='right ' src='http://learningthreejs.com/data/casting-shadows/images/screenshot-shadowCameraVisible-small.png' width='' height='' alt='' title=''&gt;&lt;/p&gt;

&lt;p&gt;In the same vibe, it possible to show the shadow camera on the screen
with &lt;code&gt;shadowCameraVisible&lt;/code&gt;.
A very usefull feature during tuning or debugging.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;light.shadowCameraVisible = true;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;More of Directional Lights&lt;/h2&gt;

&lt;p&gt;&lt;img class='right ' src='http://learningthreejs.com/data/casting-shadows/images/screenshot-fustrum-orthographic-small.png' width='' height='' alt='' title=''&gt;
&lt;img class='left  ' src='http://learningthreejs.com/data/casting-shadows/images/screenshot-fustrum-perspective-small.png' width='' height='' alt='' title=''&gt;&lt;/p&gt;

&lt;p&gt;Additionally, when casting shadow with a
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/lights/DirectionalLight.js&quot;&gt;THREE.DirectionalLight&lt;/a&gt;,
you need to setup an orthographic camera.
What is that ? it is a different form of
&lt;a href=&quot;http://en.wikipedia.org/wiki/3D_projection&quot;&gt;3D projection&lt;/a&gt;.
&lt;a href=&quot;http://en.wikipedia.org/wiki/Perspective_(graphical)&quot;&gt;Perspective&lt;/a&gt;
is the way we see things in real life.
So it seems more natural to us than
&lt;a href=&quot;http://en.wikipedia.org/wiki/Orthographic_projection&quot;&gt;orthographic projection&lt;/a&gt;.
On the left, an illustration shows a perspective projection.
You can see what is inside the orange shape.
On the right, the same for a orthographic one.&lt;/p&gt;

&lt;p&gt;Recent
&lt;a href=&quot;https://github.com/mrdoob/three.js/commit/32b581f24fddeaf9e91b7825aa93ec0ad3a45c83&quot;&gt;three.js r47 release&lt;/a&gt;
includes a
&lt;a href=&quot;http://mrdoob.github.com/three.js/examples/webgl_camera.html&quot;&gt;very didactic example&lt;/a&gt;
from
&lt;a href=&quot;http://alteredqualia.com/&quot;&gt;alteredq&lt;/a&gt;.
Play with it, it may understand the difference between
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/cameras/OrthographicCamera.js&quot;&gt;orthographic&lt;/a&gt;
and
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/cameras/PerspectiveCamera.js&quot;&gt;perspective&lt;/a&gt;
cameras.
Here is a possible configuration of the frustum for the orthographic camera of our light.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;light.shadowCameraRight     =  5;
light.shadowCameraLeft      = -5;
light.shadowCameraTop       =  5;
light.shadowCameraBottom    = -5;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;This is it, you can code shadow casting in three.js now :)
Go ahead and play with them. They are hard to master but very efficient visually.
Keep in mind that those shadows aren't real.
They only uses
&lt;a href=&quot;http://en.wikipedia.org/wiki/Shadow_mapping&quot;&gt;'some tricks'&lt;/a&gt;
to make them appears as real. And they do so in real time !!
To achieve this result, they take significant shortcuts which
produce artifacts. To avoid those require tuning and experience.&lt;/p&gt;

&lt;p&gt;That's all for today folks. Have fun.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Boilerplate Builder for Three.js</title>
    <link href="http://learningthreejs.com/blog/2012/01/19/boilerplate-builder-for-three-js/"/>
    <updated>2012-01-19T10:59:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/01/19/boilerplate-builder-for-three-js</id>
    <content type="html">&lt;p&gt;We recently introduced a
&lt;a href=&quot;https://github.com/jeromeetienne/threejsboilerplate&quot;&gt;boilerplate for three.js&lt;/a&gt;
in a
&lt;a href=&quot;http://learningthreejs.com/blog/2011/12/20/boilerplate-for-three-js/&quot;&gt;previous post&lt;/a&gt;.
It aims to ease your first contact with
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;.
It contains a template for a simple project,
a sample on which we already applied good practices.
You download it and run it in a matter of minutes.
Thus you can immediatly focus on your own things.
In short, it aims for &lt;em&gt;Fast bootstrap + Good Practices&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;It seems nice, hey ?
Well there is a glitch.
The
&lt;a href=&quot;https://github.com/jeromeetienne/threejsboilerplate&quot;&gt;boilerplate for three.js&lt;/a&gt;
needs more flexibily.
In a way, it acts as a ground on top of which you start your own thing.
We do our best to provide good defaults, but they are only defaults.
What if you got specific requirements ?
How to start your project then ?
The
&lt;a href=&quot;http://jeromeetienne.github.com/threejsboilerplatebuilder/&quot;&gt;boilerplate builder&lt;/a&gt;
has been written for you :)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jeromeetienne.github.com/threejsboilerplatebuilder/&quot;&gt;Try it out&lt;/a&gt;.
Go ahead, play with the options,
discover what they do and customize your own boilerplate.
The
&lt;a href=&quot;http://www.youtube.com/watch?v=ANnPWZGRsGk&quot;&gt;screencast&lt;/a&gt;
below is short introduction where i describe the
&lt;a href=&quot;http://jeromeetienne.github.com/threejsboilerplatebuilder/&quot;&gt;boilerplate builder&lt;/a&gt;.&lt;/p&gt;

&lt;!-- more --&gt;




&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/ANnPWZGRsGk?hl=en&amp;fs=1&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;h2&gt;Making-Of the Builder&lt;/h2&gt;

&lt;p&gt;The
&lt;a href=&quot;http://jeromeetienne.github.com/threejsboilerplatebuilder/&quot;&gt;builder&lt;/a&gt;
itself was interesting to build.
It uses various nice features from the current web.
It is a pure-browser webapp with a file download,
a preview of a webgl project
and a nice looking visual appearance.&lt;/p&gt;

&lt;h3&gt;Pure Browser Download&lt;/h3&gt;

&lt;p&gt;I like to write pure-browser application.
They dont require a server to run, only static files.
It makes it much easier to host your application.
So
&lt;a href=&quot;http://jeromeetienne.github.com/threejsboilerplatebuilder/&quot;&gt;boilerplate builder&lt;/a&gt;
has been written as a pure-browser application :)
It uses
&lt;a href=&quot;http://jszip.stuartk.co.uk/&quot;&gt;jszip&lt;/a&gt;
, a library which create .zip files with Javascript.
Its creates the boilerplater.zip that you download.
Additionally, it uses
&lt;a href=&quot;https://github.com/dcneiner/Downloadify&quot;&gt;downloadify&lt;/a&gt;
, a small library to create and download files without server.&lt;/p&gt;

&lt;p&gt;Together,
&lt;a href=&quot;http://jszip.stuartk.co.uk/&quot;&gt;jszip&lt;/a&gt;
and
&lt;a href=&quot;https://github.com/dcneiner/Downloadify&quot;&gt;downloadify&lt;/a&gt;
makes it easy to pack several files together,
and allow the user to download it.
All that in pure-browser, neat no?
I love what the web is becoming!&lt;/p&gt;

&lt;h3&gt;Boilerplate Preview&lt;/h3&gt;

&lt;p&gt;The preview is a bit different.
We start to load the &lt;em&gt;index.html&lt;/em&gt; template for the boilerplate.
We apply all the options you configured and produce the final version.
To actually preview this file, we encode it in
&lt;a href=&quot;http://en.wikipedia.org/wiki/Base64&quot;&gt;base64&lt;/a&gt;
to build a
&lt;a href=&quot;http://en.wikipedia.org/wiki/Data_URI_scheme&quot;&gt;data url&lt;/a&gt;
with it.
Only then, we create an iframe with this data uri
and you can see the webgl preview :)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Data_URI_scheme&quot;&gt;Data url&lt;/a&gt;
is &lt;a href=&quot;http://tools.ietf.org/html/rfc2397&quot;&gt;an old thing from 1998&lt;/a&gt;
which is back in spotlight due to HTML5.
It allows to encode data directly in the URL.
It may be used to include image directly in css for examples.
Very usefull but not for human consumption.
To give you an idea, here is
&lt;a href=&quot;http://pastebin.com/yF3XDSFW&quot;&gt;index.html&lt;/a&gt;
as a data url in
&lt;a href=&quot;http://en.wikipedia.org/wiki/Base64&quot;&gt;base64&lt;/a&gt;.
You could encode it as text if you
&lt;a href=&quot;https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/encodeURI&quot;&gt;escape&lt;/a&gt;
it
&lt;a href=&quot;https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/encodeURIComponent&quot;&gt;properly&lt;/a&gt;.
It looks like long ugly random string.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;data:text/html;base64,PCFkb2N0eXBlIGh0....
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h3&gt;Visual Appearance&lt;/h3&gt;

&lt;p&gt;It includes
&lt;a href=&quot;http://twitter.github.com/bootstrap/&quot;&gt;twitter bootstrap&lt;/a&gt; for css.
I am quite grateful for this framework.
Without it, the
&lt;a href=&quot;http://jeromeetienne.github.com/threejsboilerplatebuilder/&quot;&gt;builder page&lt;/a&gt;
will be so ugly, that people run away without even trying the application itself.
&lt;a href=&quot;http://twitter.github.com/bootstrap/&quot;&gt;twitter bootstrap&lt;/a&gt;
makes it so easy to write a webapp which looks good on the screen.
I think all the css-impaired of the world should thanks twitter for this framework :)&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;It has been quite fun to write it.
I learned some web skills,
discovered new part of three.js,
and on top of that, it looks good on screen.
I could not ask for more.
The goal of
&lt;a href=&quot;http://jeromeetienne.github.com/threejsboilerplatebuilder/&quot;&gt;boilerplate builder for three.js&lt;/a&gt;
is to add more &lt;em&gt;flexibility&lt;/em&gt; to the &lt;em&gt;fast bootstrap + good practices&lt;/em&gt; from the
&lt;a href=&quot;https://github.com/jeromeetienne/threejsboilerplate&quot;&gt;boilerplate&lt;/a&gt;.
I hope it will help people starting lots of new
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;
projects :)&lt;/p&gt;

&lt;p&gt;That's all folks.
Have fun.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Dom Events in 3D Space</title>
    <link href="http://learningthreejs.com/blog/2012/01/17/dom-events-in-3d-space/"/>
    <updated>2012-01-17T11:56:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/01/17/dom-events-in-3d-space</id>
    <content type="html">&lt;p&gt;Ever dreamed of a &lt;strong&gt;object3d.on('click', function(){ ... });&lt;/strong&gt;?&lt;/p&gt;

&lt;p&gt;I have :) This post presents a little experiment.
What about implementing the concept of
&lt;a href=&quot;http://www.w3.org/TR/DOM-Level-2-Events/events.html&quot;&gt;dom events&lt;/a&gt;
in 3D Space.
In a web page, a
&lt;a href=&quot;http://www.quirksmode.org/dom/events/click.html&quot;&gt;click&lt;/a&gt;
event is trigger when a user click on a
&lt;a href=&quot;http://en.wikipedia.org/wiki/HTML_element&quot;&gt;element&lt;/a&gt;.
This is common knowledge in web development.
What about having that but in a three.js scene ?
Maybe people will start do 3D user interface with that, who knows.
How great would that be ?!?
So let's do that.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jeromeetienne.github.com/threex/examples/threex.domevent/&quot;&gt;Try it out&lt;/a&gt;.
The demo contains 3 teapots.
Each bind a different type of events.
When the events are triggered, teapots are animated.
Animations are made by &lt;a href=&quot;https://github.com/sole/tween.js/&quot;&gt;tween.js&lt;/a&gt;, a nice js tweening engine
seen in a &lt;a href=&quot;http://learningthreejs.com/blog/2011/08/17/tweenjs-for-smooth-animation/&quot;&gt;previous post&lt;/a&gt;.
Play with it to get a feel of it, maybe think about the type of UI you could do in 3D.&lt;/p&gt;

&lt;!-- more --&gt;




&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/c2KLj8sie9Q?hl=en&amp;fs=1&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;h2&gt;Let's Get Started&lt;/h2&gt;

&lt;p&gt;First let's include the source.
You download &lt;a href=&quot;https://github.com/jeromeetienne/threex/blob/master/threex.domevent.js&quot;&gt;threex.domevent.js&lt;/a&gt;.
and copy this line in your page.&lt;/p&gt;

&lt;p&gt;```html&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;script src='threex.domevent.js'&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Let's Use It&lt;/h2&gt;

&lt;iframe src=&quot;http://jeromeetienne.github.com/threex/examples/threex.domevent&quot;
    webkitallowfullscreen mozallowfullscreen allowfullscreen 
    width=&quot;420&quot; height=&quot;315&quot; frameborder=&quot;0&quot; style=&quot;float: right; margin-left: 1em;&quot;&gt;
&lt;/iframe&gt;


&lt;p&gt;Let's say we want do to an action when the user is clicking on a object.
We just do the following.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mesh.on('click', function(){
    mesh.scale.x *= 2;
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;This short line means &quot;&lt;em&gt;if the user click on this mesh, make it twice wider&lt;/em&gt;&quot;.
Eloquent meaning, short syntax ... pretty sweet in my book.
If you wish to stop listening just do as usual.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mesh.off('click', callback)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;In fact, there is 2 naming for those functions:
one is
&lt;a href=&quot;https://developer.mozilla.org/en/DOM/element.addEventListener&quot;&gt;addEventListener&lt;/a&gt;
/
&lt;a href=&quot;https://developer.mozilla.org/en/DOM/element.removeEventListener&quot;&gt;removeEventListener&lt;/a&gt;
from
&lt;a href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/semantics.html&quot;&gt;HTMLElement&lt;/a&gt;
The other is copied on
&lt;a href=&quot;http://jquery.com/&quot;&gt;jQuery&lt;/a&gt; api:
&lt;a href=&quot;http://api.jquery.com/on/&quot;&gt;on&lt;/a&gt;
/
&lt;a href=&quot;http://api.jquery.com/off/&quot;&gt;off&lt;/a&gt;
Pick the one you like. They are doing the same thing.&lt;/p&gt;

&lt;p&gt;Always in a effort to stay close to usual pratices, the events name are the same as in DOM.
The semantic is the same too.
Currently, the available events are
&lt;a href=&quot;http://www.quirksmode.org/dom/events/click.html&quot;&gt;click, dblclick, mouseup, mousedown&lt;/a&gt;,
&lt;a href=&quot;http://www.quirksmode.org/dom/events/mouseover.html&quot;&gt;mouseover and mouse out&lt;/a&gt;.&lt;/p&gt;

&lt;h2&gt;Some Internals&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;
already has the ability to interact with the mouse.
You can see it in action
&lt;a href=&quot;http://mrdoob.github.com/three.js/examples/webgl_interactive_cubes.html&quot;&gt;here&lt;/a&gt;
and
&lt;a href=&quot;http://mrdoob.github.com/three.js/examples/webgl_interactive_voxelpainter.html&quot;&gt;here&lt;/a&gt;.
Internally they use 2 three.js classes:
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/core/Projector.js&quot;&gt;THREE.Projector&lt;/a&gt;
and
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/core/Ray.js&quot;&gt;THREE.Ray&lt;/a&gt;.
&lt;a href=&quot;https://github.com/jeromeetienne/threex/blob/master/threex.domevent.js&quot;&gt;threex.domevent.js&lt;/a&gt;
is an higher level api on top of those functions,
an interface which mimic dom events,
something closer to the usual web developper.&lt;/p&gt;

&lt;p&gt;It is a nice api. clean, short, object oriented and feels familiar to web developpers.
A little hichup tho, it modifies THREE.Object3D class.
It is a global class, so it may be legitimatly considered unclean by some people.
If this bother you, simply do &lt;code&gt;THREEx.DomEvent.noConflict()&lt;/code&gt; and use the
standalone API. It is documented in the
&lt;a href=&quot;http://jeromeetienne.github.com/threex/docs/threex.domevent.html&quot;&gt;annoted source&lt;/a&gt;.
In fact, the object oriented API is just a thin wrapper
on top of the standalone API.&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;We all know the click event when the user click on a webpage.
This experiment wishes to provide to web developpers the same experience in 3D.
I hope people will do crazy innovations by using 3D in user interfaces.
This is a first version. Maybe we will implement
&lt;a href=&quot;http://www.quirksmode.org/js/events_order.html&quot;&gt;bubbling&lt;/a&gt;
in the future, even events like
&lt;a href=&quot;http://www.quirksmode.org/dom/events/change.html&quot;&gt;'change'&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As usual, &lt;a href=&quot;https://github.com/jeromeetienne/threex/blob/master/threex.domevent.js&quot;&gt;threex.domevent.js&lt;/a&gt;
source is available on
&lt;a href=&quot;https://github.com/jeromeetienne/threex/blob/master/threex.domevent.js&quot;&gt;github&lt;/a&gt;.
There is an
&lt;a href=&quot;http://jeromeetienne.github.com/threex/docs/threex.domevent.html&quot;&gt;annoted source&lt;/a&gt;
for implementation details.
That's all folks. Have fun.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Tunnel Effect for your Demo</title>
    <link href="http://learningthreejs.com/blog/2012/01/11/tunnel-effect/"/>
    <updated>2012-01-11T13:00:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2012/01/11/tunnel-effect</id>
    <content type="html">&lt;p&gt;This post presents a tunnel effect.
This is a classic in 3D demo.
They are visually efficient and easy to code.
In fact, tunnels are so trendy that
even
&lt;a href=&quot;http://en.wikipedia.org/wiki/Doctor_Who&quot;&gt;doctor who&lt;/a&gt;
and
&lt;a href=&quot;http://en.wikipedia.org/wiki/Stargate&quot;&gt;stargate&lt;/a&gt;
have
&lt;a href=&quot;http://www.youtube.com/watch?v=IKo9f5npLNM&quot;&gt;fun&lt;/a&gt;
&lt;a href=&quot;http://www.youtube.com/watch?v=KDIdJtW0vN4&quot;&gt;in them&lt;/a&gt;
:)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jeromeetienne.github.com/tunnelgl/&quot;&gt;Try the demo&lt;/a&gt;.
It has been built using the
&lt;a href=&quot;https://github.com/jeromeetienne/threejsboilerplate&quot;&gt;boilerplate for three.js&lt;/a&gt;
seen in a
&lt;a href=&quot;http://learningthreejs.com/blog/2011/12/20/boilerplate-for-three-js/&quot;&gt;previous post&lt;/a&gt;.
The code is simple and small.
Less than 20lines has been added on top of the boilerplate.
We will create a
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/core/Geometry.js&quot;&gt;THREE.Geometry&lt;/a&gt;
to get the shape of tunnel.
Then we will use a
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/textures/Texture.js&quot;&gt;texture&lt;/a&gt;
trick to create the
&lt;a href=&quot;http://en.wikipedia.org/wiki/Optical_illusion&quot;&gt;visual illusion&lt;/a&gt;
of moving.&lt;/p&gt;

&lt;!-- more --&gt;




&lt;iframe src=&quot;http://jeromeetienne.github.com/tunnelgl/&quot;
    webkitallowfullscreen mozallowfullscreen allowfullscreen 
    width=&quot;100%&quot; height=&quot;420px&quot; frameborder=&quot;0&quot;&gt;
&lt;/iframe&gt;


&lt;h2&gt;Let's build the walls&lt;/h2&gt;

&lt;p&gt;The first step is to build the &lt;em&gt;walls&lt;/em&gt; of the tunnel.
It is easier that one would expect.
A tunnel may be seen as a cylinder with the camera inside.
Once you realized that, most of the work is done.
Luckily for us,
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;
got an easy way to build cylinders, called
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/extras/geometries/CylinderGeometry.js&quot;&gt;CylinderGeometry&lt;/a&gt;.
Nevertheless our tunnel / cylinder got 2 special points.&lt;/p&gt;

&lt;p&gt;First, it is open-ended. So we must not build its top and bottom.
We need this to see thru its extremities.
This is handled by a parameter in
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/extras/geometries/CylinderGeometry.js&quot;&gt;CylinderGeometry&lt;/a&gt;.
We just set &lt;code&gt;openended&lt;/code&gt; parameter to true and the rest is done for us :)&lt;/p&gt;

&lt;p&gt;Second, the camera is usually located outside of objects.
But our tunnel/cylinder has the camera inside it.
To make our object visible from the inside, we need to turn it inside out.
For that, just use &lt;code&gt;mesh.flipSided = true&lt;/code&gt;&lt;/p&gt;

&lt;h2&gt;Let's go forward&lt;/h2&gt;

&lt;p&gt;Now we need to go forward in this tunnel
For that we will use an old trick.
We won't move the tunnel walls themselves, only their appearance.
It gives the visual illusion that we are moving.
Remember what they say in matrix ?
&lt;a href=&quot;http://www.youtube.com/watch?v=dzm8kTIj_0M&quot;&gt;&quot;there is no spoon&quot;&lt;/a&gt;.
It is all the same, we are moving while staying still :)&lt;/p&gt;

&lt;center&gt;
    &lt;iframe width=&quot;425&quot; height=&quot;349&quot; src=&quot;http://www.youtube.com/embed/dzm8kTIj_0M?hl=en&amp;fs=1&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;


&lt;h2&gt;A Texture isn't a spoon&lt;/h2&gt;

&lt;p&gt;First we want to move the appearance of the cylinder, thus the player got the illusion to go forward.
We will use &lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/textures/Texture.js&quot;&gt;THREE.Texture&lt;/a&gt; for that.
We wont move the actual pixels of the textures, only its coordinates.
Additionnaly we want the texture to repeat on the cylinder, thus it appears as continuous.
WebGL texture is a powerfull and flexible tool.
You can tweak so many features.&lt;/p&gt;

&lt;p&gt;First let's make this texture move.
Suppose we want the texture to loop once every 10 seconds.
So the coordinate &lt;code&gt;.offset.y&lt;/code&gt; needs to go from 0 to 1 in 10 seconds.
This line is enougth to make the tunnel move forward.
You can change your speed within the tunnel by changing this number.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;texture.offset.y    += 0.1 * seconds;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Now the texture repetition.
For that we will use a texture parameter called &lt;em&gt;wrap&lt;/em&gt;.
It indicates how the gpu repeat the texture on a face.
Here is a good
&lt;a href=&quot;http://lucera-project.blogspot.com/2010/06/opengl-wrap.html&quot;&gt;tutorial on opengl wrap&lt;/a&gt;.
By default, wrapS / wrapT are set to &lt;code&gt;THREE.ClampToEdgeWrapping&lt;/code&gt;.
So the texture is scaled to match exactly the size of the face.
In our case, we want to repeat the texture and not scale it.
So we use &lt;code&gt;THREE.RepeatWrapping&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;```javascript&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;texture.wrapT   = THREE.RepeatWrapping;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;We have seen how to do a tunnel with
&lt;a href=&quot;https://github.com/mrdoob/three.js/&quot;&gt;three.js&lt;/a&gt;.
This is very simple to code and awesome on the screen.
It is less than 20 lines added to the &lt;a href=&quot;https://github.com/jeromeetienne/threejsboilerplate&quot;&gt;boilerplate&lt;/a&gt;.
The cylinder geometry was already provided.
We used
&lt;a href=&quot;https://github.com/mrdoob/three.js/blob/master/src/textures/Texture.js&quot;&gt;THREE.Texture&lt;/a&gt;
offsets to provide the optical illusion of moving.&lt;/p&gt;

&lt;p&gt;Later, we may add a &lt;a href=&quot;http://en.wikipedia.org/wiki/TARDIS&quot;&gt;blue phonebooth&lt;/a&gt;
and play &lt;em&gt;doctor who&lt;/em&gt; :)
The code is available on
&lt;a href=&quot;https://github.com/jeromeetienne/tunnelgl&quot;&gt;github&lt;/a&gt;
under MIT license.
Feel free to fork and modify.
That's all folks, have fun.&lt;/p&gt;
</content>
  </entry>
  
</feed>
